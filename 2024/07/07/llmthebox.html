<html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="https://robsware.github.io/assets/css/syntax.css"><link rel="preconnect" href="https://cdnjs.cloudflare.com"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"><title> LLMTheBox - Using LLMs to learn from writeups - robsware</title><link rel="shortcut icon" href="https://robsware.github.io/favicon.png"><link rel="alternate" type="application/atom+xml" title="robsware" href="https://robsware.github.io/atom.xml"><link rel="alternate" type="application/json" title="robsware" href="https://robsware.github.io/feed.json" /><link rel="sitemap" type="application/xml" title="sitemap" href="https://robsware.github.io/sitemap.xml" /><link rel="preconnect" href="https://fonts.gstatic.com"><link href="https://fonts.googleapis.com/css2?family=Play:wght@400;700&family=Source+Code+Pro:ital,wght@0,200;0,300;0,400;0,600;0,700;0,900;1,300;1,400;1,500;1,600;1,700;1,900&display=swap" rel="stylesheet"><style> *,:after,:before{box-sizing:border-box;background-color:inherit;color:inherit;margin:0;padding:0}html{font-size:15px}#theme-toggle{opacity:0.65;position:relative;border-radius:5px;height:25px;display:flex;-webkit-box-align:center;align-items:center;-webkit-box-pack:center;justify-content:center;transition:opacity 0.3s ease 0s;border:none;outline:none;background:none;cursor:pointer;padding:0px;appearance:none;transform:scale(0.8)}html,html[data-theme="light"]{--text-font: Play;--source-code-font: Source Code Pro;--very-light-text-color: rgb(222, 222, 222);--light-text-color: rgb(89, 183, 255);--medium-text-color: #555;--main-text-color: #333;--highlight-text-color: #6cb4a0;--dark-text-color: #393e46;--link-color: rgb(50, 87, 209);--code-bg-color: rgb(245, 245, 245);background-color:#fff}html #theme-toggle div,html[data-theme="light"] #theme-toggle div{position:relative;width:24px;height:24px;border-radius:50%;border:none;background-color:var(--theme-ui-colors-transparent, transparent);transform:scale(1);transition:all 0.45s ease 0s;overflow:hidden;box-shadow:inset 8px -8px 0px 0px var(--theme-ui-colors-toggleIcon, #2d3748)}html #theme-toggle div::before,html[data-theme="light"] #theme-toggle div::before{content:"";position:absolute;right:-9px;top:-9px;height:24px;width:24px;border:none;border-radius:50%;transform:translate(0px, 0px);opacity:1;transition:transform 0.45s ease 0s}html #theme-toggle div::after,html[data-theme="light"] #theme-toggle div::after{content:"";width:8px;height:8px;border-radius:50%;margin:-4px 0px 0px -4px;position:absolute;top:50%;left:50%;box-shadow:0 -23px 0 var(--theme-ui-colors-toggleIcon, #2d3748),0 23px 0 var(--theme-ui-colors-toggleIcon, #2d3748),23px 0 0 var(--theme-ui-colors-toggleIcon, #2d3748),-23px 0 0 var(--theme-ui-colors-toggleIcon, #2d3748),15px 15px 0 var(--theme-ui-colors-toggleIcon, #2d3748),-15px 15px 0 var(--theme-ui-colors-toggleIcon, #2d3748),15px -15px 0 var(--theme-ui-colors-toggleIcon, #2d3748),-15px -15px 0 var(--theme-ui-colors-toggleIcon, #2d3748);transform:scale(0);transition:all 0.35s ease 0s}html[data-theme="dark"]{--text-font: Play;--source-code-font: Source Code Pro;--very-light-text-color: #EEE;--light-text-color: #c4bbf0;--medium-text-color: #52057b;--main-text-color: #EAEAEA;--highlight-text-color: #6cb4a0;--dark-text-color: rgb(36, 38, 42);--link-color: rgb(255, 89, 89);--code-bg-color: rgb(36, 38, 42);background-color:#131418}html[data-theme="dark"] #theme-toggle div{position:relative;width:24px;height:24px;border-radius:50%;border:4px solid var(--theme-ui-colors-toggleIcon, #cbd5e0);background-color:var(--theme-ui-colors-toggleIcon, #cbd5e0);transform:scale(0.55);transition:all 0.45s ease 0s;overflow:visible;box-shadow:none}html[data-theme="dark"] #theme-toggle div::before{content:"";position:absolute;right:-9px;top:-9px;height:24px;width:24px;border:2px solid var(--theme-ui-colors-toggleIcon, #cbd5e0);border-radius:50%;transform:translate(14px, -14px);opacity:0;transition:transform 0.45s ease 0s}html[data-theme="dark"] #theme-toggle div::after{content:"";width:8px;height:8px;border-radius:50%;margin:-4px 0px 0px -4px;position:absolute;top:50%;left:50%;box-shadow:0 -23px 0 var(--theme-ui-colors-toggleIcon, #cbd5e0),0 23px 0 var(--theme-ui-colors-toggleIcon, #cbd5e0),23px 0 0 var(--theme-ui-colors-toggleIcon, #cbd5e0),-23px 0 0 var(--theme-ui-colors-toggleIcon, #cbd5e0),15px 15px 0 var(--theme-ui-colors-toggleIcon, #cbd5e0),-15px 15px 0 var(--theme-ui-colors-toggleIcon, #cbd5e0),15px -15px 0 var(--theme-ui-colors-toggleIcon, #cbd5e0),-15px -15px 0 var(--theme-ui-colors-toggleIcon, #cbd5e0);transform:scale(1);transition:all 0.35s ease 0s}body{font-family:var(--text-font),monospace;text-rendering:optimizeLegibility;line-height:1.75;color:var(--main-text-color)}a{color:var(--link-color);text-decoration:none}.post p{margin:1rem 0}.meta{margin:1.4rem 0}code,pre{background:var(--code-bg-color);margin:0 -27px;border-width:1px}code{font-family:var(--source-code-font),monospace;margin:unset;padding:0.1rem;color:var(--highlight-text-color)}pre code{background-color:unset;color:unset}pre{border-width:3px;padding:0.8rem;white-space:pre-wrap;border-style:none none none solid;border-color:var(--light-text-color)}img{max-width:100%}hr{background:var(--light-text-color);height:1px;border:0}header{flex-basis:10rem;flex-grow:1;position:relative}header a{text-decoration:none}header li{margin-bottom:0.2rem;text-align:right;margin-right:2rem}header a.active{font-weight:bold}header,section{padding:1rem 0}section{margin-top:1.5rem}blockquote{font-style:italic;border-left:5px solid var(--dark-text-color);padding-left:1rem}h1{color:var(--main-text-color);text-transform:uppercase;font-size:2rem;font-weight:bold;margin-bottom:1.5rem}h2,h3,h4,h5{font-weight:bold;margin-bottom:1.5rem;font-size:2rem}h2{font-size:1.8rem}h3{font-size:1.6rem}h4{font-size:1.4rem}h5{font-size:1.2rem}h6{font-size:1rem}section h1:first-child{margin-top:0}strong,b{font-weight:bold}.photos ul{list-style:none}.photos li{margin-bottom:1.5rem}.photo picture,.project picture{margin-bottom:0.5rem}.posts>h3{font-weight:500}.post ul{margin:0px;margin:0px 0px 10px 10px}.post ol{margin:0px;margin:0px 0px 10px 15px}.posts li{align-items:center;display:flex;justify-content:space-between;margin-bottom:0.5rem}.posts li a,.posts li div,.projects li a{white-space:nowrap;overflow:hidden;text-overflow:ellipsis;font-weight:bold}.posts li time,.projects li time{padding-left:1rem;white-space:nowrap;font-variant-numeric:tabular-nums}time{color:var(--main-text-color)}.post>h1.title{font-size:x-large;margin-top:0;margin-bottom:0}.post>time{margin-bottom:0;margin-top:3rem}.highlight{margin:0px}main{display:flex;max-width:47rem;margin:-5rem auto 0;padding:2.4rem 2rem;flex-direction:column}.flex-row-between{display:flex;flex-direction:row;justify-content:space-between;margin-top:3rem}.social-footer{padding:1rem;display:flex;justify-content:center;position:initial}.social-footer .social-footer-icons .fa{font-size:1.3rem;color:#a9a9a9}.social-footer .social-footer-icons .fa:hover{color:dimgray;transition:color 0.3s ease-in}@media screen and (max-width: 45rem){header li{display:inline;margin-right:1rem}.logo{padding-bottom:1rem}header ul{border-bottom:1px solid #edf2f7;padding-bottom:2rem}nav ul{border-right:0px}.photos ul{margin-top:0.5rem}main{padding:0 2rem}}section{flex-grow:999;display:flex;flex-direction:column}figcaption{font-size:smaller}.bio{margin-bottom:1rem}::selection{background-color:#fffba0;color:#333}.search-article{position:relative}.search-article label[for="search-input"]{position:relative;top:-10px;left:11px}.search-article input[type="search"]{top:-1rem;left:0;border:0;width:100%;height:30px;outline:none;position:absolute;border-radius:5px;padding:10px 10px 10px 35px;color:var(--main-text-color);-webkit-appearance:none;background-color:rgba(128,128,128,0.1);border:1px solid rgba(128,128,128,0.1)}.search-article input[type="search"]::-webkit-input-placeholder{color:#808080}.search-article input[type="search"]::-webkit-search-decoration,.search-article input[type="search"]::-webkit-search-results-decoration{display:none}#search-results{text-align:center}#search-results li{text-align:center}#search-results li::before{content:"›";display:inline-block;margin-left:-1.3em;width:1.3em;color:var(--main-text-color)}.post-nav{display:flex;position:relative;margin-top:0;border-top:2px solid var(--light-text-color);line-height:1.4}.post-nav .post-nav-item{border-bottom:0;padding-bottom:10px;width:50%;padding-top:10px;text-decoration:none;box-sizing:border-box}.post-nav .post-nav-item .post-title{color:var(--main-text-color)}.post-nav .post-nav-item:hover .post-title,.post-nav .post-nav-item:focus .post-title{color:var(--link-color);opacity:0.9}.post-nav .post-nav-item .nav-arrow{font-size:17px;color:var(--main-text-color);margin-bottom:3px;font-weight:bold}.post-nav .post-nav-item:nth-child(odd){padding-left:0;padding-right:20px}.post-nav .post-nav-item:nth-child(even){text-align:right;padding-right:0;padding-left:20px}.tags ul{list-style:none;display:grid;grid-template-columns:auto auto auto auto auto auto;grid-template-rows:auto auto auto auto}.tags li{white-space:normal;text-overflow:ellipsis}.timeline{position:center;width:650px;margin:-6em auto;padding:1px;list-style-type:none}@media (max-width: 860px){.timeline{width:100%}}.timeline:before{position:absolute;left:50%;top:0;content:' ';display:block;width:6px;height:100%;margin-left:-3px;background:var(--light-text-color);z-index:5}@media (max-width: 375px){.timeline:before{height:150%}}.timeline li{padding:2em 0}@media (max-width: 860px){.timeline li{padding:2em 0}}.timeline li::after{content:"";display:block;height:150%;clear:both;visibility:hidden}.direction-l{position:relative;width:287px;float:left;text-align:right}@media (max-width: 860px){.direction-l{float:none;width:100%;text-align:center}}.direction-l .flag{color:#333;box-shadow:-1px 1px 1px rgba(0,0,0,0.52)}.direction-l .flag:after{content:"";position:absolute;left:100%;top:50%;height:0;width:0;margin-top:-8px;border:solid transparent;border-left-color:#f8f8f8;border-width:8px;pointer-events:none}@media (max-width: 860px){.direction-l .flag:after{content:"";position:absolute;left:50%;top:-8px;height:0;width:0;margin-left:-8px;border:solid transparent;border-bottom-color:#fff;border-width:8px;pointer-events:none}}.direction-l .time-wrapper{float:left}@media (max-width: 860px){.direction-l .time-wrapper{float:none}}.direction-r{position:relative;width:293px;float:right;text-align:left}@media (max-width: 860px){.direction-r{float:none;width:100%;text-align:center}}.direction-r .flag{color:#333;box-shadow:1px 1px 1px rgba(0,0,0,0.52)}.direction-r .flag:after{content:"";position:absolute;right:100%;top:50%;height:0;width:0;margin-top:-8px;border:solid transparent;border-right-color:#f8f8f8;border-width:8px;pointer-events:none}@media (max-width: 860px){.direction-r .flag:after{content:"";position:absolute;left:50%;top:-8px;height:0;width:0;margin-left:-8px;border:solid transparent;border-bottom-color:#fff;border-width:8px;pointer-events:none}}.direction-r .flag:before{left:-40px}.direction-r .time-wrapper{float:right}@media (max-width: 860px){.direction-r .time-wrapper{float:none}}.flag-wrapper{position:relative;display:inline-block;text-align:center}@media (max-width: 860px){.flag-wrapper{text-align:center}}.flag-wrapper .flag{position:relative;display:inline;background:#f8f8f8;padding:6px 10px;border-radius:5px;font-weight:600;text-align:left}@media (max-width: 860px){.flag-wrapper .flag{background:#fff;z-index:15}}.direction-l .flag:before,.direction-r .flag:before{position:absolute;top:60%;right:-40px;content:' ';display:block;width:12px;height:12px;margin-top:-10px;background:#fff;border-radius:10px;border:4px solid var(--link-color);z-index:10}@media (max-width: 860px){.direction-l .flag:before,.direction-r .flag:before{position:absolute;top:-30px;left:53%;content:' ';display:block;margin-left:-10px}}.time-wrapper{display:inline;line-height:1em;font-size:0.66666em;color:var(--link-color);vertical-align:middle}@media (max-width: 860px){.time-wrapper{display:block;position:relative;margin:4px 0 0 0;z-index:14}}.time-wrapper .time{display:inline-block;padding:4px 6px;background:#f8f8f8}.desc{margin:1em 0.2em -3.5em 0;font-size:0.9em;line-height:1.5em}.desc a{color:var(--link-color);text-decoration:none}.desc a:hover{text-decoration:underline}@media (max-width: 860px){.desc{position:relative;margin:1em 1em 0 1em;padding:1em;background:var(--code-bg-color);box-shadow:0 0 1px rgba(0,0,0,0.2);z-index:15}}</style><title>LLMTheBox - Using LLMs to learn from writeups | robsware</title><meta name="generator" content="Jekyll v3.9.2" /><meta property="og:title" content="LLMTheBox - Using LLMs to learn from writeups" /><meta name="author" content="gesko" /><meta property="og:locale" content="en_US" /><meta name="description" content="LLMs can be applied to glean an understanding from numerous writeups." /><meta property="og:description" content="LLMs can be applied to glean an understanding from numerous writeups." /><link rel="canonical" href="https://robsware.github.io/2024/07/07/llmthebox" /><meta property="og:url" content="https://robsware.github.io/2024/07/07/llmthebox" /><meta property="og:site_name" content="robsware" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2024-07-07T00:00:00+01:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="LLMTheBox - Using LLMs to learn from writeups" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"gesko"},"dateModified":"2024-07-07T00:00:00+01:00","datePublished":"2024-07-07T00:00:00+01:00","description":"LLMs can be applied to glean an understanding from numerous writeups.","headline":"LLMTheBox - Using LLMs to learn from writeups","mainEntityOfPage":{"@type":"WebPage","@id":"https://robsware.github.io/2024/07/07/llmthebox"},"url":"https://robsware.github.io/2024/07/07/llmthebox"}</script></head><script async src="https://www.googletagmanager.com/gtag/js?id=G-2G53ZXRQTD"></script> <script> window.dataLayer = window.dataLayer || []; function gtag() { dataLayer.push(arguments); } gtag('js', new Date()); gtag('config', 'G-2G53ZXRQTD'); </script><body><main><section class="post"><div class="flex-row-between"> <a href="https://robsware.github.io/">« back</a> <button title="Change theme" id="theme-toggle" onclick="modeSwitcher()"><div></div></button></div><time datetime="2024-07-07T00:00:00+01:00">Jul 7, 2024 - 11 ' read</time><h1 class="title"> LLMTheBox - Using LLMs to learn from writeups</h1><span class="meta"> <a href="https://robsware.github.io/tag/experiments">experiments</a>, <a href="https://robsware.github.io/tag/writeups">writeups</a></span><p>This project is open source and the code can be found here: <a href="https://github.com/robsware/LLMTheBox">LLMTheBox</a></p><h2 id="why-did-i-make-this"> Why did I make this <a href="#why-did-i-make-this">#</a></h2><p>In part I wanted to play around with embeddings and in part because I enjoy revisiting certain HTB boxes.</p><p>I wanted to explore how accurage RAG via embeddings can get, especially with a huge volume of data - about 45k lines of writeups. I knew the theory, but I wanted the practice too, especially because I really think that RAG is what truly unlocks the power of LLMs, as it boosts both accuracy and can act as long term memory. Let’s get into how it works.</p><h2 id="the-data"> The Data <a href="#the-data">#</a></h2><p>I relied entirely on the amazing HTB writeups written by 0xdf at <a href="https://0xdf.gitlab.io/">https://0xdf.gitlab.io/</a>. He has writeups for every single box, including sherlocks and other non box related blog posts. To extract only the links that actually contained box writeups, I wrote a simple python scrapper:</p><div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">from</span> <span class="nn">bs4</span> <span class="kn">import</span> <span class="n">BeautifulSoup</span>

<span class="k">def</span> <span class="nf">scrape_links_and_save</span><span class="p">():</span>
    <span class="c1"># Hardcoded URL of the webpage to scrape
</span>    <span class="n">url</span> <span class="o">=</span> <span class="s">'https://0xdf.gitlab.io'</span>  <span class="c1"># Replace with the actual URL
</span>    <span class="c1"># Hardcoded output file path
</span>    <span class="n">output_file</span> <span class="o">=</span> <span class="s">'data/htb_links.txt'</span>

    <span class="c1"># Send a GET request to the webpage
</span>    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
    <span class="n">links_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">complete_links_list</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># Check if the request was successful
</span>    <span class="k">if</span> <span class="n">response</span><span class="p">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
        <span class="c1"># Parse the content of the request with BeautifulSoup
</span>        <span class="n">soup</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">response</span><span class="p">.</span><span class="n">content</span><span class="p">,</span> <span class="s">'html.parser'</span><span class="p">)</span>
        
        <span class="c1"># Find all 'a' tags with the class 'post-link'
</span>        <span class="n">links</span> <span class="o">=</span> <span class="n">soup</span><span class="p">.</span><span class="n">find_all</span><span class="p">(</span><span class="s">'a'</span><span class="p">,</span> <span class="n">class_</span><span class="o">=</span><span class="s">'post-link'</span><span class="p">)</span>
        
        <span class="c1"># Extract the href attribute of each link
</span>        <span class="k">for</span> <span class="n">link</span> <span class="ow">in</span> <span class="n">links</span><span class="p">:</span>
            <span class="n">href</span> <span class="o">=</span> <span class="n">link</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">'href'</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">href</span> <span class="ow">and</span> <span class="n">re</span><span class="p">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s">'/\d{4}/\d{2}/\d{2}/htb-[^/]+\.html$'</span><span class="p">,</span> <span class="n">href</span><span class="p">):</span>
                <span class="n">links_list</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">href</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">'Failed to retrieve the webpage. Status code: </span><span class="si">{</span><span class="n">response</span><span class="p">.</span><span class="n">status_code</span><span class="si">}</span><span class="s">'</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">link</span> <span class="ow">in</span> <span class="n">links_list</span><span class="p">:</span>
        <span class="n">link</span> <span class="o">=</span> <span class="n">url</span> <span class="o">+</span> <span class="n">link</span>
        <span class="n">complete_links_list</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">link</span><span class="p">)</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">output_file</span><span class="p">,</span> <span class="s">'w'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">link</span> <span class="ow">in</span> <span class="n">complete_links_list</span><span class="p">:</span>
            <span class="k">if</span> <span class="s">"sherlock"</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">link</span><span class="p">.</span><span class="n">lower</span><span class="p">():</span>  <span class="c1"># Use .lower() to make the check case-insensitive
</span>                <span class="n">f</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s">"</span><span class="si">{</span><span class="n">link</span><span class="si">}</span><span class="se">\n</span><span class="s">"</span><span class="p">)</span>

<span class="c1">#scrape_links_and_save()
</span></code></pre></div></div><p>This short script will extract the full links just for the actual writeups and save them to a .txt file, which can now be parsed.</p><h2 id="parsing-the-data"> Parsing the Data <a href="#parsing-the-data">#</a></h2><p>Thankfully, 0xdf writes expectional blog posts that follow the same format. I wrote a parser that extracts the box difficutly, the nmap output and then each of the “Shell as X” or “Auth as Y” and other important sections that are relevant in the writeup. Essentially, everything that isn’t a detailed nmap out, feroxbuster output, or pictures.</p><div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">bs4</span> <span class="kn">import</span> <span class="n">BeautifulSoup</span>
<span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">import</span> <span class="nn">re</span>

<span class="k">def</span> <span class="nf">extract_htb_data</span><span class="p">():</span>
    <span class="n">input_file</span> <span class="o">=</span> <span class="s">'data/htb_links.txt'</span>
    <span class="n">output_file</span> <span class="o">=</span> <span class="s">"data/htbtext.txt"</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">input_file</span><span class="p">,</span> <span class="s">'r'</span><span class="p">)</span> <span class="k">as</span> <span class="nb">file</span><span class="p">:</span>
        <span class="n">urls</span> <span class="o">=</span> <span class="nb">file</span><span class="p">.</span><span class="n">read</span><span class="p">().</span><span class="n">splitlines</span><span class="p">()</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">output_file</span><span class="p">,</span> <span class="s">"w"</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s">"utf-8"</span><span class="p">)</span> <span class="k">as</span> <span class="nb">file</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">url</span> <span class="ow">in</span> <span class="n">urls</span><span class="p">:</span>
            <span class="c1"># Send a GET request to the URL
</span>            <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>

            <span class="c1"># Replace the specific phrase in the HTML content
</span>            <span class="n">cleaned_content</span> <span class="o">=</span> <span class="n">response</span><span class="p">.</span><span class="n">text</span><span class="p">.</span><span class="n">replace</span><span class="p">(</span><span class="s">"CTF solutions, malware analysis, home lab development"</span><span class="p">,</span> <span class="s">""</span><span class="p">)</span>

            <span class="c1"># Parse the cleaned HTML content
</span>            <span class="n">soup</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">cleaned_content</span><span class="p">,</span> <span class="s">'html.parser'</span><span class="p">)</span>

            <span class="n">rows</span> <span class="o">=</span> <span class="n">soup</span><span class="p">.</span><span class="n">find_all</span><span class="p">(</span><span class="s">'tr'</span><span class="p">)</span>

            <span class="c1">####################
</span>            <span class="c1">##Difficulty rating#
</span>            <span class="c1">####################
</span>            <span class="nb">file</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="s">"Difficulty Rating:"</span> <span class="o">+</span> <span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">)</span>
            <span class="c1"># Iterating through the rows and extracting the text
</span>            <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">rows</span><span class="p">:</span>
                <span class="n">cells</span> <span class="o">=</span> <span class="n">row</span><span class="p">.</span><span class="n">find_all</span><span class="p">(</span><span class="s">'td'</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">cells</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="c1"># Check if the first cell contains a &lt;picture&gt; element
</span>                    <span class="k">if</span> <span class="n">cells</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">find</span><span class="p">(</span><span class="s">'picture'</span><span class="p">)</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                        <span class="n">key</span> <span class="o">=</span> <span class="n">cells</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">get_text</span><span class="p">(</span><span class="n">strip</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s">"Rated Difficulty"</span><span class="p">,</span> <span class="s">"Radar Graph"</span><span class="p">,</span> <span class="s">"Retire Date"</span><span class="p">,</span> <span class="s">"Creator"</span><span class="p">]:</span>
                            <span class="n">value</span> <span class="o">=</span> <span class="n">cells</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">get_text</span><span class="p">(</span><span class="n">strip</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
                            <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s"> : </span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
                            <span class="nb">file</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s">"</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s"> : </span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s">"</span> <span class="o">+</span> <span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">)</span>

            <span class="c1">#################
</span>            <span class="c1">#####Nmap Text###
</span>            <span class="c1">#################
</span>            <span class="nb">file</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="s">"Nmap scan:"</span> <span class="o">+</span> <span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">)</span>
            <span class="n">pre_tag</span> <span class="o">=</span> <span class="n">soup</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="s">'pre'</span><span class="p">,</span> <span class="n">class_</span><span class="o">=</span><span class="s">'highlight'</span><span class="p">)</span>

            <span class="c1"># If the pre_tag is found, process it
</span>            <span class="k">if</span> <span class="n">pre_tag</span><span class="p">:</span>
                <span class="c1"># Get the text content of the &lt;pre&gt; tag
</span>                <span class="n">pre_text</span> <span class="o">=</span> <span class="n">pre_tag</span><span class="p">.</span><span class="n">get_text</span><span class="p">()</span>

                <span class="c1"># Define the start and end patterns
</span>                <span class="n">start_pattern</span> <span class="o">=</span> <span class="n">re</span><span class="p">.</span><span class="nb">compile</span><span class="p">(</span><span class="sa">r</span><span class="s">'Nmap scan report for.*'</span><span class="p">)</span>
                <span class="n">end_pattern</span> <span class="o">=</span> <span class="n">re</span><span class="p">.</span><span class="nb">compile</span><span class="p">(</span><span class="sa">r</span><span class="s">'Nmap done.*'</span><span class="p">)</span>

                <span class="c1"># Search for the start and end patterns
</span>                <span class="n">start_match</span> <span class="o">=</span> <span class="n">start_pattern</span><span class="p">.</span><span class="n">search</span><span class="p">(</span><span class="n">pre_text</span><span class="p">)</span>
                <span class="n">end_match</span> <span class="o">=</span> <span class="n">end_pattern</span><span class="p">.</span><span class="n">search</span><span class="p">(</span><span class="n">pre_text</span><span class="p">)</span>

                <span class="c1"># Extract the text between the start and end matches
</span>                <span class="k">if</span> <span class="n">start_match</span> <span class="ow">and</span> <span class="n">end_match</span><span class="p">:</span>
                    <span class="n">start_index</span> <span class="o">=</span> <span class="n">start_match</span><span class="p">.</span><span class="n">end</span><span class="p">()</span>
                    <span class="n">end_index</span> <span class="o">=</span> <span class="n">end_match</span><span class="p">.</span><span class="n">start</span><span class="p">()</span>
                    <span class="n">nmap_output</span> <span class="o">=</span> <span class="n">pre_text</span><span class="p">[</span><span class="n">start_index</span><span class="p">:</span><span class="n">end_index</span><span class="p">].</span><span class="n">strip</span><span class="p">()</span>
                    <span class="k">print</span><span class="p">(</span><span class="n">nmap_output</span><span class="p">)</span>
                    <span class="nb">file</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">nmap_output</span> <span class="o">+</span> <span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">print</span><span class="p">(</span><span class="s">"Patterns not found in the text."</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="s">"No &lt;pre&gt; tag with the specified class found."</span><span class="p">)</span>

            <span class="k">print</span><span class="p">(</span><span class="s">'##############################################################'</span><span class="p">)</span>

            <span class="c1">#################
</span>            <span class="c1">#####Paragraphs between Headers with "shell-as" in ID###
</span>            <span class="c1">#################
</span>
            <span class="c1"># Dictionary to store content by header
</span>            <span class="n">content_by_header</span> <span class="o">=</span> <span class="p">{}</span>

            <span class="c1"># Variable to keep track of the current header
</span>            <span class="n">current_header</span> <span class="o">=</span> <span class="bp">None</span>

            <span class="c1"># Define the ID patterns to match
</span>            <span class="n">patterns</span> <span class="o">=</span> <span class="p">[</span><span class="s">'recon'</span><span class="p">,</span> <span class="s">'shell-as-'</span><span class="p">,</span> <span class="s">'auth-as-'</span><span class="p">,</span> <span class="s">'rce-as-'</span><span class="p">]</span>

            <span class="c1"># Function to check if an ID matches any of the patterns
</span>            <span class="k">def</span> <span class="nf">id_matches</span><span class="p">(</span><span class="nb">id</span><span class="p">):</span>
                <span class="k">return</span> <span class="nb">any</span><span class="p">(</span><span class="nb">id</span><span class="p">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">pattern</span><span class="p">)</span> <span class="k">for</span> <span class="n">pattern</span> <span class="ow">in</span> <span class="n">patterns</span><span class="p">)</span>

            <span class="c1"># Iterate over all elements in the soup
</span>            <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">soup</span><span class="p">.</span><span class="n">find_all</span><span class="p">([</span><span class="s">'h2'</span><span class="p">,</span> <span class="s">'h3'</span><span class="p">,</span> <span class="s">'h4'</span><span class="p">,</span> <span class="s">'h5'</span><span class="p">,</span> <span class="s">'h6'</span><span class="p">,</span> <span class="s">'p'</span><span class="p">]):</span>
                <span class="c1"># Check if the element is a header and its ID matches any of the patterns
</span>                <span class="k">if</span> <span class="n">element</span><span class="p">.</span><span class="n">name</span> <span class="ow">in</span> <span class="p">[</span><span class="s">'h2'</span><span class="p">,</span> <span class="s">'h3'</span><span class="p">,</span> <span class="s">'h4'</span><span class="p">,</span> <span class="s">'h5'</span><span class="p">,</span> <span class="s">'h6'</span><span class="p">]</span> <span class="ow">and</span> <span class="n">id_matches</span><span class="p">(</span><span class="n">element</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">'id'</span><span class="p">,</span> <span class="s">''</span><span class="p">)):</span>
                    <span class="n">current_header</span> <span class="o">=</span> <span class="n">element</span><span class="p">.</span><span class="n">get_text</span><span class="p">()</span>
                    <span class="n">content_by_header</span><span class="p">[</span><span class="n">current_header</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="c1"># If the element is a paragraph and we have a current header
</span>                <span class="k">elif</span> <span class="n">element</span><span class="p">.</span><span class="n">name</span> <span class="o">==</span> <span class="s">'p'</span> <span class="ow">and</span> <span class="n">current_header</span><span class="p">:</span>
                    <span class="n">content_by_header</span><span class="p">[</span><span class="n">current_header</span><span class="p">].</span><span class="n">append</span><span class="p">(</span><span class="n">element</span><span class="p">.</span><span class="n">get_text</span><span class="p">())</span>

            <span class="c1"># Print the extracted contents
</span>            <span class="k">for</span> <span class="n">header</span><span class="p">,</span> <span class="n">paragraphs</span> <span class="ow">in</span> <span class="n">content_by_header</span><span class="p">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"Category: </span><span class="si">{</span><span class="n">header</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
                <span class="nb">file</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s">"Category: </span><span class="si">{</span><span class="n">header</span><span class="si">}</span><span class="se">\n</span><span class="s">"</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">paragraph</span> <span class="ow">in</span> <span class="n">paragraphs</span><span class="p">:</span>
                    <span class="k">if</span> <span class="s">"Click for full size image"</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">paragraph</span><span class="p">:</span>
                        <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"</span><span class="si">{</span><span class="n">paragraph</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
                        <span class="nb">file</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s">"</span><span class="si">{</span><span class="n">paragraph</span><span class="si">}</span><span class="se">\n</span><span class="s">"</span><span class="p">)</span>
                <span class="nb">file</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">)</span>
                <span class="k">print</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">)</span>

<span class="c1">#extract_htb_data()
</span></code></pre></div></div><p>This script is a bit messier because of the way I wanted the data structured, but it works out great. Minor caveat is that some of 0xdf’s really old writeups do not quite follow his more recent format so some data got lost.</p><h2 id="building-the-chroma-database"> Building the chroma database <a href="#building-the-chroma-database">#</a></h2><p>I picked chroma because it’s fast, opensource, and I can store it locally. Probably not the most scalable solution, but it was easy to learn and set up using langchains. The code isn’t too complicated and more or less follows a template. I used OpenAI Embeddings with a TextLoader function to tokenize the writeups.</p><div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">langchain.vectorstores</span> <span class="kn">import</span> <span class="n">Chroma</span>
<span class="kn">from</span> <span class="nn">langchain_community.document_loaders</span> <span class="kn">import</span> <span class="n">TextLoader</span>
<span class="kn">from</span> <span class="nn">langchain_community.embeddings</span> <span class="kn">import</span> <span class="n">OpenAIEmbeddings</span>

<span class="k">def</span> <span class="nf">initialize_chroma_db</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">persist_directory</span><span class="p">,</span> <span class="n">collection_name</span><span class="p">):</span>
    <span class="c1"># Load a text document and split it into sections
</span>    <span class="n">loader</span> <span class="o">=</span> <span class="n">TextLoader</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s">'cp437'</span><span class="p">)</span>
    <span class="n">docs</span> <span class="o">=</span> <span class="n">loader</span><span class="p">.</span><span class="n">load_and_split</span><span class="p">()</span>

    <span class="c1"># Initialize the OpenAI embeddings
</span>    <span class="n">embeddings</span> <span class="o">=</span> <span class="n">OpenAIEmbeddings</span><span class="p">()</span>

    <span class="c1"># Load the Chroma database from disk or create a new one if it doesn't exist
</span>    <span class="n">chroma_db</span> <span class="o">=</span> <span class="n">Chroma</span><span class="p">(</span><span class="n">persist_directory</span><span class="o">=</span><span class="n">persist_directory</span><span class="p">,</span> 
                       <span class="n">embedding_function</span><span class="o">=</span><span class="n">embeddings</span><span class="p">,</span>
                       <span class="n">collection_name</span><span class="o">=</span><span class="n">collection_name</span><span class="p">)</span>

    <span class="c1"># Get the collection from the Chroma database
</span>    <span class="n">collection</span> <span class="o">=</span> <span class="n">chroma_db</span><span class="p">.</span><span class="n">get</span><span class="p">()</span>

    <span class="c1"># If the collection is empty, create a new one
</span>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">collection</span><span class="p">[</span><span class="s">'ids'</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="c1"># Create a new Chroma database from the documents
</span>        <span class="n">chroma_db</span> <span class="o">=</span> <span class="n">Chroma</span><span class="p">.</span><span class="n">from_documents</span><span class="p">(</span>
            <span class="n">documents</span><span class="o">=</span><span class="n">docs</span><span class="p">,</span> 
            <span class="n">embedding</span><span class="o">=</span><span class="n">embeddings</span><span class="p">,</span> 
            <span class="n">persist_directory</span><span class="o">=</span><span class="n">persist_directory</span><span class="p">,</span>
            <span class="n">collection_name</span><span class="o">=</span><span class="n">collection_name</span>
        <span class="p">)</span>

        <span class="c1"># Save the Chroma database to disk
</span>        <span class="n">chroma_db</span><span class="p">.</span><span class="n">persist</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">chroma_db</span>

<span class="c1"># Example of how to call the function
# chroma_db = initialize_chroma_db("data/htbtext_short.txt", "data", "htb_small_db")
</span></code></pre></div></div><p>This creates a persistent DB that can be accessed later. Since my source data doesn’t change much, there was no reason to keep an ephemeral one.</p><p><strong>The query function</strong></p><p>Finally, the real meat of this weekend project, the main script that calls all the other ones and actually initializes the database into an OpneAI call. Thankfully, it’s also quite short, even though a tad overengineered - I got carried away with some TDD ideas!</p><div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># langchain_ask.py
</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">langchain.chains</span> <span class="kn">import</span> <span class="n">RetrievalQA</span>
<span class="kn">from</span> <span class="nn">langchain.vectorstores</span> <span class="kn">import</span> <span class="n">Chroma</span>
<span class="kn">from</span> <span class="nn">langchain_community.chat_models</span> <span class="kn">import</span> <span class="n">ChatOpenAI</span>
<span class="kn">from</span> <span class="nn">langchain.embeddings.openai</span> <span class="kn">import</span> <span class="n">OpenAIEmbeddings</span>
<span class="kn">from</span> <span class="nn">createchroma</span> <span class="kn">import</span> <span class="n">initialize_chroma_db</span>
<span class="kn">from</span> <span class="nn">scraper</span> <span class="kn">import</span> <span class="n">scrape_links_and_save</span>
<span class="kn">from</span> <span class="nn">download_page_content</span> <span class="kn">import</span> <span class="n">extract_htb_data</span>
<span class="kn">import</span> <span class="nn">warnings</span>  <span class="c1"># Import the warnings module
</span>
<span class="c1"># Suppress all warnings
</span><span class="n">warnings</span><span class="p">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s">"ignore"</span><span class="p">)</span>



<span class="k">def</span> <span class="nf">initialize_chat_model</span><span class="p">(</span><span class="n">model_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s">"gpt-4-turbo"</span><span class="p">,</span> <span class="n">temperature</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.8</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">ChatOpenAI</span><span class="p">(</span><span class="n">model_name</span><span class="o">=</span><span class="n">model_name</span><span class="p">,</span> <span class="n">temperature</span><span class="o">=</span><span class="n">temperature</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">initialize_embeddings</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">OpenAIEmbeddings</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">load_chroma_db</span><span class="p">(</span><span class="n">persist_directory</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s">"data"</span><span class="p">,</span> <span class="n">collection_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s">"htb_small_db"</span><span class="p">):</span>

    <span class="n">embeddings</span> <span class="o">=</span> <span class="n">initialize_embeddings</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">Chroma</span><span class="p">(</span><span class="n">persist_directory</span><span class="o">=</span><span class="n">persist_directory</span><span class="p">,</span>
                  <span class="n">embedding_function</span><span class="o">=</span><span class="n">embeddings</span><span class="p">,</span>
                  <span class="n">collection_name</span><span class="o">=</span><span class="n">collection_name</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">get_user_query</span><span class="p">():</span>
    <span class="k">return</span> <span class="nb">input</span><span class="p">(</span><span class="s">"Please enter your query: "</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">execute_query</span><span class="p">(</span><span class="n">chroma_db</span><span class="p">,</span> <span class="n">llm</span><span class="p">,</span> <span class="n">query</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>

    <span class="n">tagged_docs</span> <span class="o">=</span> <span class="n">chroma_db</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">where</span><span class="o">=</span><span class="p">{</span><span class="s">"tag"</span><span class="p">:</span> <span class="s">"htb_small"</span><span class="p">})</span>

    <span class="k">if</span> <span class="n">tagged_docs</span><span class="p">:</span>
        <span class="n">chain</span> <span class="o">=</span> <span class="n">RetrievalQA</span><span class="p">.</span><span class="n">from_chain_type</span><span class="p">(</span><span class="n">llm</span><span class="o">=</span><span class="n">llm</span><span class="p">,</span>
                                            <span class="n">chain_type</span><span class="o">=</span><span class="s">"stuff"</span><span class="p">,</span>
                                            <span class="n">retriever</span><span class="o">=</span><span class="n">chroma_db</span><span class="p">.</span><span class="n">as_retriever</span><span class="p">())</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">chain</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">response</span><span class="p">[</span><span class="s">'result'</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="s">"No documents found in the collection."</span>


<span class="k">def</span> <span class="nf">check_data_folder</span><span class="p">(</span><span class="n">folder_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s">"data"</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>

    <span class="k">if</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">exists</span><span class="p">(</span><span class="n">folder_path</span><span class="p">)</span> <span class="ow">and</span> <span class="n">os</span><span class="p">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">folder_path</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">True</span>
    <span class="k">return</span> <span class="bp">False</span>


<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">check_data_folder</span><span class="p">():</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"Data folder is empty"</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"Generating links to scrape..."</span><span class="p">)</span>
        <span class="n">scrape_links_and_save</span><span class="p">()</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"Downloading page contents..."</span><span class="p">)</span>
        <span class="n">extract_htb_data</span><span class="p">()</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"Creating DB..."</span><span class="p">)</span>
        <span class="n">chroma_db</span> <span class="o">=</span> <span class="n">initialize_chroma_db</span><span class="p">(</span><span class="s">"data/htbtext.txt"</span><span class="p">,</span> <span class="s">"data"</span><span class="p">,</span> <span class="s">"htb_small_db"</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"Chroma DB created successfully."</span><span class="p">)</span>
    

    <span class="n">llm</span> <span class="o">=</span> <span class="n">initialize_chat_model</span><span class="p">()</span>
    <span class="n">chroma_db</span> <span class="o">=</span> <span class="n">load_chroma_db</span><span class="p">()</span>
    <span class="n">user_query</span> <span class="o">=</span> <span class="n">get_user_query</span><span class="p">()</span>
    <span class="n">query</span> <span class="o">=</span> <span class="s">"Answer questions based on the document you have received. "</span> <span class="o">+</span> <span class="n">user_query</span>



    <span class="n">response</span> <span class="o">=</span> <span class="n">execute_query</span><span class="p">(</span><span class="n">chroma_db</span><span class="p">,</span> <span class="n">llm</span><span class="p">,</span> <span class="n">query</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>


<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">"__main__"</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</code></pre></div></div><p>The first time the script is execture, it will automatically create the chroma DB and download the files required to build it, which can take a few minutes, although the actual sizes of both the writeups file and the chromaDB are quite small at 50-60 MBs.</p><p>Once everything is set up, the script can be executed and will ask for user input. I’ve found it very cooperative even when it came to sensitive queries, and below is just a mild example:</p><p><img src="/assets/images/llmthebox.png" alt="" /></p><p>Hooray!</p><h2 id="applications"> Applications <a href="#applications">#</a></h2><p>Besides the tinkering aspect of this and exploring LLM libraries and technologies, I think this has some use for infosec people too. It can be used as a creativity tool when you are stuck on a pentest, and I think it can be especially useful to people trying to get into the field that are learning and practicing HackTheBox and similar platforms. With something like this little tool, they are able to better query previous writeups and see what kind of challenges they can expect.</p><p>I am an optimist when it comes to LLMs, and I am looking forward to incorporating the lessons learned in this project into a larger one in the near future! I am thinking about creating an assistant that’s actually useful and non intrusive for high achiever.</p><p>In the meantime, gotta keep learning.</p></section><section><nav class="post-nav"> <a class="post-nav-item post-nav-prev" href="/2024/05/26/osce3"><div class="nav-arrow">Previous</div><span class="post-title">OSCE3 Thoughts</span> </a></nav></section></main><script> function setTheme(theme) { if (theme === "dark") { document.documentElement.setAttribute('data-theme', 'dark'); window.localStorage.setItem('theme', 'dark'); document.getElementById("theme-toggle").classList.add('sun'); document.getElementById("theme-toggle").classList.remove('moon'); } else { document.documentElement.setAttribute('data-theme', 'light'); window.localStorage.setItem('theme', 'light'); document.getElementById("theme-toggle").classList.add('moon'); document.getElementById("theme-toggle").classList.remove('sun'); } } let theme = localStorage.getItem('theme'); theme = theme || (window.matchMedia ? window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light' : 'light'); setTheme(theme); function modeSwitcher() { let currentMode = document.documentElement.getAttribute('data-theme'); if (currentMode === "dark") { setTheme('light'); } else { setTheme('dark'); } } </script></body><footer class="social-footer"><div class="social-footer-icons"> <a href="https://github.com/robsware" title="Github profile" target="_blank" rel="noopener noreferrer"><i class="fa fa-github" aria-hidden="true"></i></a> <a href="https://robsware.github.io/atom.xml" title="Feed RSS" target="_blank" rel="noopener noreferrer"><i class="fa fa-rss" aria-hidden="true"></i></a> <a href="https://github.com/robsware/robsware.github.io" title="Browse the code" target="_blank" rel="noopener noreferrer"><i class="fa fa-code" aria-hidden="true"></i></a></div></footer></html>
