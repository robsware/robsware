---
layout: page
---

<section class="post">
    <div class="flex-row-between">
        <a href="{{ site.url }}{{ site.baseurl }}/2023-03-26"> Previous challenge</a>
             <a href="{{ site.url }}{{ site.baseurl }}/"> Home</a>
      <button title="Change theme" id="theme-toggle" onclick="modeSwitcher()">
        <div></div>
      </button>
    </div>
  </section>
The vulnerability is Missing Authorization
{% highlight html %}
<!DOCTYPE html>
<html>
  <head>
    <title>Change Email</title>
  </head>
  <body>
    <h1>Change Email</h1>
    <label for="new-email">New Email:</label>
    <input type="email" id="new-email">
    <button onclick="changeEmail()">Change Email</button>

    <script>
      // Database object assumes user data is stored here
      const database = {
        users: [
          {
            id: 1,
            name: "John",
            email: "john@gmail.com"
          },
          {
            id: 2,
            name: "Jane",
            email: "jane@gmail.com"
          }
        ],
        updateUserEmail: function(userId, newEmail) {
          const user = this.users.find(user => user.id === userId);
          user.email = newEmail;
          console.log(`Email for user ${userId} updated to ${newEmail}`);
        }
      };

      function getUserId() {
        const userId = prompt("Enter your user id:");
        return parseInt(userId);
      }

      function changeEmail() {
        const newEmail = document.getElementById("new-email").value;
        const userId = getUserId();
        database.updateUserEmail(userId, newEmail);
      }

    </script>
  </body>
</html>


{% endhighlight %}


In the above code, any user can change the email of any other user, as there is no check for authorization.

Fix:



{% highlight html %}
function changeEmail(newEmail) {
  let userId = getUserId(); // Assuming this function returns the id of the logged-in user
  let userRole = getUserRole(userId); // Assuming this function returns the role of the logged-in user
  
  if(userRole === 'admin') {
    let targetUserId = prompt('Enter the user id whose email you want to update:');
    database.updateUserEmail(targetUserId, newEmail);
  } else {
    database.updateUserEmail(userId, newEmail);
  }
}

{% endhighlight %}