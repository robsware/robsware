<html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="https://robsware.github.io/assets/css/syntax.css"><link rel="preconnect" href="https://cdnjs.cloudflare.com"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"><title> The making of a Discord bot, from a joke project to (some) usefulness. - robsware</title><link rel="shortcut icon" href="https://robsware.github.io/favicon.png"><link rel="alternate" type="application/atom+xml" title="robsware" href="https://robsware.github.io/atom.xml"><link rel="alternate" type="application/json" title="robsware" href="https://robsware.github.io/feed.json" /><link rel="sitemap" type="application/xml" title="sitemap" href="https://robsware.github.io/sitemap.xml" /><link rel="preconnect" href="https://fonts.gstatic.com"><link href="https://fonts.googleapis.com/css2?family=Play:wght@400;700&family=Source+Code+Pro:ital,wght@0,200;0,300;0,400;0,600;0,700;0,900;1,300;1,400;1,500;1,600;1,700;1,900&display=swap" rel="stylesheet"><style> *,:after,:before{box-sizing:border-box;background-color:inherit;color:inherit;margin:0;padding:0}html{font-size:15px}#theme-toggle{opacity:0.65;position:relative;border-radius:5px;height:25px;display:flex;-webkit-box-align:center;align-items:center;-webkit-box-pack:center;justify-content:center;transition:opacity 0.3s ease 0s;border:none;outline:none;background:none;cursor:pointer;padding:0px;appearance:none;transform:scale(0.8)}html,html[data-theme="light"]{--text-font: Play;--source-code-font: Source Code Pro;--very-light-text-color: rgb(222, 222, 222);--light-text-color: rgb(89, 183, 255);--medium-text-color: #555;--main-text-color: #333;--highlight-text-color: #6cb4a0;--dark-text-color: #393e46;--link-color: rgb(50, 87, 209);--code-bg-color: rgb(245, 245, 245);background-color:#fff}html #theme-toggle div,html[data-theme="light"] #theme-toggle div{position:relative;width:24px;height:24px;border-radius:50%;border:none;background-color:var(--theme-ui-colors-transparent, transparent);transform:scale(1);transition:all 0.45s ease 0s;overflow:hidden;box-shadow:inset 8px -8px 0px 0px var(--theme-ui-colors-toggleIcon, #2d3748)}html #theme-toggle div::before,html[data-theme="light"] #theme-toggle div::before{content:"";position:absolute;right:-9px;top:-9px;height:24px;width:24px;border:none;border-radius:50%;transform:translate(0px, 0px);opacity:1;transition:transform 0.45s ease 0s}html #theme-toggle div::after,html[data-theme="light"] #theme-toggle div::after{content:"";width:8px;height:8px;border-radius:50%;margin:-4px 0px 0px -4px;position:absolute;top:50%;left:50%;box-shadow:0 -23px 0 var(--theme-ui-colors-toggleIcon, #2d3748),0 23px 0 var(--theme-ui-colors-toggleIcon, #2d3748),23px 0 0 var(--theme-ui-colors-toggleIcon, #2d3748),-23px 0 0 var(--theme-ui-colors-toggleIcon, #2d3748),15px 15px 0 var(--theme-ui-colors-toggleIcon, #2d3748),-15px 15px 0 var(--theme-ui-colors-toggleIcon, #2d3748),15px -15px 0 var(--theme-ui-colors-toggleIcon, #2d3748),-15px -15px 0 var(--theme-ui-colors-toggleIcon, #2d3748);transform:scale(0);transition:all 0.35s ease 0s}html[data-theme="dark"]{--text-font: Play;--source-code-font: Source Code Pro;--very-light-text-color: #EEE;--light-text-color: #c4bbf0;--medium-text-color: #52057b;--main-text-color: #EAEAEA;--highlight-text-color: #6cb4a0;--dark-text-color: rgb(36, 38, 42);--link-color: rgb(255, 89, 89);--code-bg-color: rgb(36, 38, 42);background-color:#131418}html[data-theme="dark"] #theme-toggle div{position:relative;width:24px;height:24px;border-radius:50%;border:4px solid var(--theme-ui-colors-toggleIcon, #cbd5e0);background-color:var(--theme-ui-colors-toggleIcon, #cbd5e0);transform:scale(0.55);transition:all 0.45s ease 0s;overflow:visible;box-shadow:none}html[data-theme="dark"] #theme-toggle div::before{content:"";position:absolute;right:-9px;top:-9px;height:24px;width:24px;border:2px solid var(--theme-ui-colors-toggleIcon, #cbd5e0);border-radius:50%;transform:translate(14px, -14px);opacity:0;transition:transform 0.45s ease 0s}html[data-theme="dark"] #theme-toggle div::after{content:"";width:8px;height:8px;border-radius:50%;margin:-4px 0px 0px -4px;position:absolute;top:50%;left:50%;box-shadow:0 -23px 0 var(--theme-ui-colors-toggleIcon, #cbd5e0),0 23px 0 var(--theme-ui-colors-toggleIcon, #cbd5e0),23px 0 0 var(--theme-ui-colors-toggleIcon, #cbd5e0),-23px 0 0 var(--theme-ui-colors-toggleIcon, #cbd5e0),15px 15px 0 var(--theme-ui-colors-toggleIcon, #cbd5e0),-15px 15px 0 var(--theme-ui-colors-toggleIcon, #cbd5e0),15px -15px 0 var(--theme-ui-colors-toggleIcon, #cbd5e0),-15px -15px 0 var(--theme-ui-colors-toggleIcon, #cbd5e0);transform:scale(1);transition:all 0.35s ease 0s}body{font-family:var(--text-font),monospace;text-rendering:optimizeLegibility;line-height:1.75;color:var(--main-text-color)}a{color:var(--link-color);text-decoration:none}.post p{margin:1rem 0}.meta{margin:1.4rem 0}code,pre{background:var(--code-bg-color);margin:0 -27px;border-width:1px}code{font-family:var(--source-code-font),monospace;margin:unset;padding:0.1rem;color:var(--highlight-text-color)}pre code{background-color:unset;color:unset}pre{border-width:3px;padding:0.8rem;white-space:pre-wrap;border-style:none none none solid;border-color:var(--light-text-color)}img{max-width:100%}hr{background:var(--light-text-color);height:1px;border:0}header{flex-basis:10rem;flex-grow:1;position:relative}header a{text-decoration:none}header li{margin-bottom:0.2rem;text-align:right;margin-right:2rem}header a.active{font-weight:bold}header,section{padding:1rem 0}section{margin-top:1.5rem}blockquote{font-style:italic;border-left:5px solid var(--dark-text-color);padding-left:1rem}h1{color:var(--main-text-color);text-transform:uppercase;font-size:2rem;font-weight:bold;margin-bottom:1.5rem}h2,h3,h4,h5{font-weight:bold;margin-bottom:1.5rem;font-size:2rem}h2{font-size:1.8rem}h3{font-size:1.6rem}h4{font-size:1.4rem}h5{font-size:1.2rem}h6{font-size:1rem}section h1:first-child{margin-top:0}strong,b{font-weight:bold}.photos ul{list-style:none}.photos li{margin-bottom:1.5rem}.photo picture,.project picture{margin-bottom:0.5rem}.posts>h3{font-weight:500}.post ul{margin:0px;margin:0px 0px 10px 10px}.post ol{margin:0px;margin:0px 0px 10px 15px}.posts li{align-items:center;display:flex;justify-content:space-between;margin-bottom:0.5rem}.posts li a,.posts li div,.projects li a{white-space:nowrap;overflow:hidden;text-overflow:ellipsis;font-weight:bold}.posts li time,.projects li time{padding-left:1rem;white-space:nowrap;font-variant-numeric:tabular-nums}time{color:var(--main-text-color)}.post>h1.title{font-size:x-large;margin-top:0;margin-bottom:0}.post>time{margin-bottom:0;margin-top:3rem}.highlight{margin:0px}main{display:flex;max-width:47rem;margin:-5rem auto 0;padding:2.4rem 2rem;flex-direction:column}.flex-row-between{display:flex;flex-direction:row;justify-content:space-between;margin-top:3rem}.social-footer{padding:1rem;display:flex;justify-content:center;position:initial}.social-footer .social-footer-icons .fa{font-size:1.3rem;color:#a9a9a9}.social-footer .social-footer-icons .fa:hover{color:dimgray;transition:color 0.3s ease-in}@media screen and (max-width: 45rem){header li{display:inline;margin-right:1rem}.logo{padding-bottom:1rem}header ul{border-bottom:1px solid #edf2f7;padding-bottom:2rem}nav ul{border-right:0px}.photos ul{margin-top:0.5rem}main{padding:0 2rem}}section{flex-grow:999;display:flex;flex-direction:column}figcaption{font-size:smaller}.bio{margin-bottom:1rem}::selection{background-color:#fffba0;color:#333}.search-article{position:relative}.search-article label[for="search-input"]{position:relative;top:-10px;left:11px}.search-article input[type="search"]{top:-1rem;left:0;border:0;width:100%;height:30px;outline:none;position:absolute;border-radius:5px;padding:10px 10px 10px 35px;color:var(--main-text-color);-webkit-appearance:none;background-color:rgba(128,128,128,0.1);border:1px solid rgba(128,128,128,0.1)}.search-article input[type="search"]::-webkit-input-placeholder{color:#808080}.search-article input[type="search"]::-webkit-search-decoration,.search-article input[type="search"]::-webkit-search-results-decoration{display:none}#search-results{text-align:center}#search-results li{text-align:center}#search-results li::before{content:"›";display:inline-block;margin-left:-1.3em;width:1.3em;color:var(--main-text-color)}.post-nav{display:flex;position:relative;margin-top:0;border-top:2px solid var(--light-text-color);line-height:1.4}.post-nav .post-nav-item{border-bottom:0;padding-bottom:10px;width:50%;padding-top:10px;text-decoration:none;box-sizing:border-box}.post-nav .post-nav-item .post-title{color:var(--main-text-color)}.post-nav .post-nav-item:hover .post-title,.post-nav .post-nav-item:focus .post-title{color:var(--link-color);opacity:0.9}.post-nav .post-nav-item .nav-arrow{font-size:17px;color:var(--main-text-color);margin-bottom:3px;font-weight:bold}.post-nav .post-nav-item:nth-child(odd){padding-left:0;padding-right:20px}.post-nav .post-nav-item:nth-child(even){text-align:right;padding-right:0;padding-left:20px}.tags ul{list-style:none;display:grid;grid-template-columns:auto auto auto auto auto auto;grid-template-rows:auto auto auto auto}.tags li{white-space:normal;text-overflow:ellipsis}.timeline{position:center;width:650px;margin:-6em auto;padding:1px;list-style-type:none}@media (max-width: 860px){.timeline{width:100%}}.timeline:before{position:absolute;left:50%;top:0;content:' ';display:block;width:6px;height:100%;margin-left:-3px;background:var(--light-text-color);z-index:5}@media (max-width: 375px){.timeline:before{height:150%}}.timeline li{padding:2em 0}@media (max-width: 860px){.timeline li{padding:2em 0}}.timeline li::after{content:"";display:block;height:150%;clear:both;visibility:hidden}.direction-l{position:relative;width:287px;float:left;text-align:right}@media (max-width: 860px){.direction-l{float:none;width:100%;text-align:center}}.direction-l .flag{color:#333;box-shadow:-1px 1px 1px rgba(0,0,0,0.52)}.direction-l .flag:after{content:"";position:absolute;left:100%;top:50%;height:0;width:0;margin-top:-8px;border:solid transparent;border-left-color:#f8f8f8;border-width:8px;pointer-events:none}@media (max-width: 860px){.direction-l .flag:after{content:"";position:absolute;left:50%;top:-8px;height:0;width:0;margin-left:-8px;border:solid transparent;border-bottom-color:#fff;border-width:8px;pointer-events:none}}.direction-l .time-wrapper{float:left}@media (max-width: 860px){.direction-l .time-wrapper{float:none}}.direction-r{position:relative;width:293px;float:right;text-align:left}@media (max-width: 860px){.direction-r{float:none;width:100%;text-align:center}}.direction-r .flag{color:#333;box-shadow:1px 1px 1px rgba(0,0,0,0.52)}.direction-r .flag:after{content:"";position:absolute;right:100%;top:50%;height:0;width:0;margin-top:-8px;border:solid transparent;border-right-color:#f8f8f8;border-width:8px;pointer-events:none}@media (max-width: 860px){.direction-r .flag:after{content:"";position:absolute;left:50%;top:-8px;height:0;width:0;margin-left:-8px;border:solid transparent;border-bottom-color:#fff;border-width:8px;pointer-events:none}}.direction-r .flag:before{left:-40px}.direction-r .time-wrapper{float:right}@media (max-width: 860px){.direction-r .time-wrapper{float:none}}.flag-wrapper{position:relative;display:inline-block;text-align:center}@media (max-width: 860px){.flag-wrapper{text-align:center}}.flag-wrapper .flag{position:relative;display:inline;background:#f8f8f8;padding:6px 10px;border-radius:5px;font-weight:600;text-align:left}@media (max-width: 860px){.flag-wrapper .flag{background:#fff;z-index:15}}.direction-l .flag:before,.direction-r .flag:before{position:absolute;top:60%;right:-40px;content:' ';display:block;width:12px;height:12px;margin-top:-10px;background:#fff;border-radius:10px;border:4px solid var(--link-color);z-index:10}@media (max-width: 860px){.direction-l .flag:before,.direction-r .flag:before{position:absolute;top:-30px;left:53%;content:' ';display:block;margin-left:-10px}}.time-wrapper{display:inline;line-height:1em;font-size:0.66666em;color:var(--link-color);vertical-align:middle}@media (max-width: 860px){.time-wrapper{display:block;position:relative;margin:4px 0 0 0;z-index:14}}.time-wrapper .time{display:inline-block;padding:4px 6px;background:#f8f8f8}.desc{margin:1em 0.2em -3.5em 0;font-size:0.9em;line-height:1.5em}.desc a{color:var(--link-color);text-decoration:none}.desc a:hover{text-decoration:underline}@media (max-width: 860px){.desc{position:relative;margin:1em 1em 0 1em;padding:1em;background:var(--code-bg-color);box-shadow:0 0 1px rgba(0,0,0,0.2);z-index:15}}</style><title>The making of a Discord bot, from a joke project to (some) usefulness. | robsware</title><meta name="generator" content="Jekyll v3.9.2" /><meta property="og:title" content="The making of a Discord bot, from a joke project to (some) usefulness." /><meta name="author" content="gesko" /><meta property="og:locale" content="en_US" /><meta name="description" content="A journey into learning new APIs, JavaScript and breaking web sockets." /><meta property="og:description" content="A journey into learning new APIs, JavaScript and breaking web sockets." /><link rel="canonical" href="https://robsware.github.io/2022/08/21/ump9" /><meta property="og:url" content="https://robsware.github.io/2022/08/21/ump9" /><meta property="og:site_name" content="robsware" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-08-21T00:00:00+01:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="The making of a Discord bot, from a joke project to (some) usefulness." /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"gesko"},"dateModified":"2022-08-21T00:00:00+01:00","datePublished":"2022-08-21T00:00:00+01:00","description":"A journey into learning new APIs, JavaScript and breaking web sockets.","headline":"The making of a Discord bot, from a joke project to (some) usefulness.","mainEntityOfPage":{"@type":"WebPage","@id":"https://robsware.github.io/2022/08/21/ump9"},"url":"https://robsware.github.io/2022/08/21/ump9"}</script></head><script async src="https://www.googletagmanager.com/gtag/js?id=G-2G53ZXRQTD"></script> <script> window.dataLayer = window.dataLayer || []; function gtag() { dataLayer.push(arguments); } gtag('js', new Date()); gtag('config', 'G-2G53ZXRQTD'); </script><body><main><section class="post"><div class="flex-row-between"> <a href="https://robsware.github.io/">« back</a> <button title="Change theme" id="theme-toggle" onclick="modeSwitcher()"><div></div></button></div><time datetime="2022-08-21T00:00:00+01:00">Aug 21, 2022 - 19 ' read</time><h1 class="title"> The making of a Discord bot, from a joke project to (some) usefulness.</h1><span class="meta"> <a href="https://robsware.github.io/tag/experiments">experiments</a>, <a href="https://robsware.github.io/tag/tutorials">tutorials</a></span><p>In early 2020, when the lockdowns were still going strong, I got possessed by this incredible need to create a bot. Bots have been a subject of fascination for me for a long time, out of various reasons, and now I wanted to get my hands dirty and build something for my small Discord community.</p><p>The bot has been through a number of revisions and refactoring as I have switched technologies around and the discord API changed and expanded, but I have stuck with javascript throughout its full duration and learned a lot of useful things!</p><p>To get the weird stuff out of the way, UMP9 is a character from the mobile strategy game Girls Frontline. She is a bit of an airhead so it was the perfect choice for a crappy bot.</p><p><img src="/assets/images/ump9.png" alt="" /></p><p>The code is available at the bottom of this article.</p><p><strong>Feature List</strong></p><div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Reaction images
Conversational AI
Reminders
Weekly PSA
Reboot option
Delete messages
Random Discord interactions
Image tagging
Real time status adjustments
Soundboard
Linux fortune
Other misc discord features
</code></pre></div></div><p>Let’s go through them in order:</p><h2 id="reaction-images"> Reaction Images <a href="#reaction-images">#</a></h2><p>Arguably the simplest feature. The biggest leap Discord made from other chat applications was its ability to host and display pictures. This feature was quickly requested by the users for funposting and memes. After a few updates, the most recent Discord API makes adding this feature really easy:</p><div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">client</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="dl">'</span><span class="s1">ready</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(){</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">UMP9, ready for deployment!</span><span class="dl">"</span><span class="p">);</span>


                <span class="c1">// ./Assets/Images/</span>
                <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">mess</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="dl">'</span><span class="s1">!416dance</span><span class="dl">'</span><span class="p">))</span> <span class="p">{</span>
                    <span class="nx">message</span><span class="p">.</span><span class="nx">channel</span><span class="p">.</span><span class="nx">send</span><span class="p">({</span> <span class="na">files</span><span class="p">:</span> <span class="p">[{</span> <span class="na">attachment</span><span class="p">:</span> <span class="dl">'</span><span class="s1">./Assets/Images/416dance.gif</span><span class="dl">'</span> <span class="p">}]</span> <span class="p">});</span>
                <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">mess</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="dl">'</span><span class="s1">!wrong</span><span class="dl">'</span><span class="p">))</span> <span class="p">{</span>
                    <span class="nx">message</span><span class="p">.</span><span class="nx">channel</span><span class="p">.</span><span class="nx">send</span><span class="p">({</span> <span class="na">files</span><span class="p">:</span> <span class="p">[{</span> <span class="na">attachment</span><span class="p">:</span> <span class="dl">'</span><span class="s1">./Assets/Images/halp.png</span><span class="dl">'</span> <span class="p">}]</span> <span class="p">});</span>
                <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">mess</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="dl">'</span><span class="s1">!flash</span><span class="dl">'</span><span class="p">))</span> <span class="p">{</span>
                    <span class="nx">message</span><span class="p">.</span><span class="nx">channel</span><span class="p">.</span><span class="nx">send</span><span class="p">({</span> <span class="na">files</span><span class="p">:</span> <span class="p">[{</span> <span class="na">attachment</span><span class="p">:</span> <span class="dl">'</span><span class="s1">./Assets/Images/flash.png</span><span class="dl">'</span> <span class="p">}]</span> <span class="p">});</span>
                <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">mess</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="dl">'</span><span class="s1">!show me </span><span class="dl">'</span><span class="p">))</span> <span class="p">{</span>
                    <span class="kd">var</span> <span class="nx">str</span> <span class="o">=</span> <span class="nx">mess</span><span class="p">,</span>
                        <span class="nx">delimiter</span> <span class="o">=</span> <span class="dl">'</span><span class="s1"> </span><span class="dl">'</span><span class="p">,</span>
                        <span class="nx">start</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
                        <span class="nx">tokens</span> <span class="o">=</span> <span class="nx">str</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="nx">delimiter</span><span class="p">).</span><span class="nx">slice</span><span class="p">(</span><span class="nx">start</span><span class="p">),</span>
                        <span class="nx">result</span> <span class="o">=</span> <span class="nx">tokens</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">delimiter</span><span class="p">);</span>
 
                    <span class="nx">message</span><span class="p">.</span><span class="nx">channel</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="dl">"</span><span class="s2">I see </span><span class="dl">"</span> <span class="o">+</span> <span class="nx">result</span><span class="p">,</span> <span class="p">{</span>
                        <span class="na">files</span><span class="p">:</span>  <span class="p">[{</span> <span class="na">attachment</span><span class="p">:</span> <span class="dl">'</span><span class="s1">./Assets/Images/danger.png</span><span class="dl">'</span> <span class="p">}]</span>
                    <span class="p">});</span>
                <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">mess</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="dl">'</span><span class="s1">!danger</span><span class="dl">'</span><span class="p">))</span> <span class="p">{</span>
                    <span class="nx">message</span><span class="p">.</span><span class="nx">channel</span><span class="p">.</span><span class="nx">send</span><span class="p">({</span> <span class="na">files</span><span class="p">:</span> <span class="p">[{</span> <span class="na">attachment</span><span class="p">:</span> <span class="dl">'</span><span class="s1">./Assets/Images/danger.png</span><span class="dl">'</span> <span class="p">}]</span> <span class="p">});</span>
                <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">mess</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="dl">'</span><span class="s1">!monday</span><span class="dl">'</span><span class="p">))</span> <span class="p">{</span>
                    <span class="nx">message</span><span class="p">.</span><span class="nx">channel</span><span class="p">.</span><span class="nx">send</span><span class="p">({</span> <span class="na">files</span><span class="p">:</span> <span class="p">[{</span> <span class="na">attachment</span><span class="p">:</span> <span class="dl">'</span><span class="s1">./Assets/Images/mondays.png</span><span class="dl">'</span> <span class="p">}]</span> <span class="p">});</span>
                <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">mess</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="dl">'</span><span class="s1">!coffee</span><span class="dl">'</span><span class="p">))</span> <span class="p">{</span>
                    <span class="nx">message</span><span class="p">.</span><span class="nx">channel</span><span class="p">.</span><span class="nx">send</span><span class="p">({</span> <span class="na">files</span><span class="p">:</span> <span class="p">[{</span> <span class="na">attachment</span><span class="p">:</span> <span class="dl">'</span><span class="s1">./Assets/Images/cofee.jpg</span><span class="dl">'</span> <span class="p">}]</span> <span class="p">});</span>
                <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">mess</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="dl">'</span><span class="s1">!wednesday</span><span class="dl">'</span><span class="p">))</span> <span class="p">{</span>
                    <span class="nx">message</span><span class="p">.</span><span class="nx">channel</span><span class="p">.</span><span class="nx">send</span><span class="p">({</span> <span class="na">files</span><span class="p">:</span> <span class="p">[{</span> <span class="na">attachment</span><span class="p">:</span> <span class="dl">'</span><span class="s1">./Assets/Images/wednesday.jpg</span><span class="dl">'</span> <span class="p">}]</span> <span class="p">});</span>
                <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">mess</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="dl">'</span><span class="s1">!nogawed</span><span class="dl">'</span><span class="p">))</span> <span class="p">{</span>
                    <span class="nx">message</span><span class="p">.</span><span class="nx">channel</span><span class="p">.</span><span class="nx">send</span><span class="p">({</span> <span class="na">files</span><span class="p">:</span> <span class="p">[{</span> <span class="na">attachment</span><span class="p">:</span> <span class="dl">'</span><span class="s1">./Assets/Images/nogawed.jpg</span><span class="dl">'</span> <span class="p">}]</span> <span class="p">});</span>
                <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">mess</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="dl">'</span><span class="s1">!smug</span><span class="dl">'</span><span class="p">))</span> <span class="p">{</span>
                    <span class="nx">message</span><span class="p">.</span><span class="nx">channel</span><span class="p">.</span><span class="nx">send</span> <span class="p">({</span> <span class="na">files</span><span class="p">:</span> <span class="p">[{</span> <span class="na">attachment</span><span class="p">:</span> <span class="dl">'</span><span class="s1">./Assets/Images/smug.jpg</span><span class="dl">'</span> <span class="p">}]</span> <span class="p">});</span>              
                <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">mess</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="dl">'</span><span class="s1">!hype</span><span class="dl">'</span><span class="p">))</span> <span class="p">{</span>
                    <span class="nx">message</span><span class="p">.</span><span class="nx">channel</span><span class="p">.</span><span class="nx">send</span><span class="p">({</span> <span class="na">files</span><span class="p">:</span> <span class="p">[{</span> <span class="na">attachment</span><span class="p">:</span> <span class="dl">'</span><span class="s1">./Assets/Images/hype.gif</span><span class="dl">'</span> <span class="p">}]</span> <span class="p">});</span>

</code></pre></div></div><p>One of the functions that I did as an experiment was the !show me one. It simply returns the input with an image of UMP9 pointing which is occasionally funny.</p><h2 id="conversational-ai"> Conversational AI <a href="#conversational-ai">#</a></h2><p>The meat of the project and also the section on which I cannot go into too much detail. I will say what I tried:</p><p><strong>Google DialogFlow</strong></p><p>The very first attempts were via Google’s DialogFlow options. I picked this one because it was both free and easy to use and the input recognition was formidable even back in 2020. It also used to have a free tier with no limit back in 2020. Unfortunately, google deleted my project when they changed tiers and I no longer have any screenshots, but DialogFlow works based on a very simple prompt system.</p><p><img src="/assets/images/dialogflow.png" alt="" /></p><p>The machine learning working in the background is smart enough to give the right response to queries even if they are not worded in the precises way defined in DialogFlow.</p><p>This was a fine system and I can absolutely see its use in business chatbots. Unfortunately, I wanted a bot that people could naturally talk to.</p><p><strong>“If you wish to make an apple pie from scratch, you must first invent the universe”</strong></p><p>Building and running my own chatbot from scratch on a laptop from 2013 would obviously be too tall of a task for what is still a joke project. I had signed up for GPT3 when it first came out, but I had yet to get access to the beta. Just as I was debating what to do next, I did get the email with a generous beta allowance. Overall I had a great time, and you can read more about it here:</p><p><a href="https://robsware.github.io/2020/12/27/gpt3">https://robsware.github.io/2020/12/27/gpt3</a></p><p>Unfortunately, my trial access to GPT3 ended rather quickly and it became too costly to keep it running as a joke. It was time for a new solution.</p><p><strong>Replika AI</strong></p><p>Here is where we start breaking ToS. Replika is a chatbot app and website that earned some minor fame and notoriety on the internet. They use a mix between GPT3 and their in house AI development to create natural responses and interactions. It’s pretty decent, and it has a free version!</p><p>Unfortunately, it cannot be used outside the app and there is no API available. Fortunately, my main area of expertise when it comes to pentesting is web. I will not go into detail here, but with some fuzzing, rotating keys on timers and the web socket protocol, I was able to intercept and redirect all the messages to and from Replika to my Discord bot. The results are very good.</p><p><img src="/assets/images/replika1.PNG" alt="" /></p><p><img src="/assets/images/replika2.png" alt="" /></p><p><img src="/assets/images/replika3.png" alt="" /></p><p>I realise this is a temporary solution and that at some point they will probably fix their web socket request and kill my access. If that happens, I will release on writeup on how I achieved it in the first place. I have been looking at Mycroft (https://mycroft.ai/) as a replacement once that happens and I do intend to give it a go at some point.</p><h2 id="reminders"> Reminders <a href="#reminders">#</a></h2><p>Since a lot of the users were using UMP9 as a notepad, I decided to add a reminder function for that purpose. It does not use a database and just relies on javascript variable storage.</p><div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="p">}</span><span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">mess</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">()</span> <span class="o">===</span> <span class="dl">"</span><span class="s2">!reminderbot</span><span class="dl">"</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">message</span><span class="p">.</span><span class="nx">channel</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="dl">"</span><span class="s2">Hello I can help you remember stuff:</span><span class="se">\n\n</span><span class="s2">!reminderbot </span><span class="se">\t\t</span><span class="s2">List of all Commands</span><span class="se">\n\n</span><span class="s2">!remindme </span><span class="se">\t\t</span><span class="s2"> {time} {message}</span><span class="se">\n\t</span><span class="s2">{time} Please have the amount of time be denoted by a time character.</span><span class="se">\n\t\t</span><span class="s2">m - minutes, s - seconds, d - days.</span><span class="se">\n</span><span class="s2">!remind {@User} {time} {message}</span><span class="se">\n\t</span><span class="s2">{time} Please have the amount of time be denoted by a time character.</span><span class="se">\n\t\t</span><span class="s2">m - minutes, s - seconds, d - days.</span><span class="se">\n\t</span><span class="dl">"</span><span class="p">);</span>
                
                <span class="c1">// Reminds a specific user</span>
                <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">mess</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">().</span><span class="nx">startsWith</span><span class="p">(</span><span class="dl">'</span><span class="s1">!remind</span><span class="dl">'</span><span class="p">))</span> <span class="p">{</span>
                    <span class="k">try</span> <span class="p">{</span>
                        
                        <span class="c1">// Variables</span>
                        <span class="kd">var</span> <span class="nx">returntime</span><span class="p">;</span>
                        <span class="kd">var</span> <span class="nx">timemeasure</span><span class="p">;</span>
                        <span class="kd">var</span> <span class="nx">userid</span><span class="p">;</span>
                        <span class="nx">mess</span> <span class="o">=</span> <span class="nx">mess</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="dl">'</span><span class="s1"> </span><span class="dl">'</span><span class="p">);</span>
                        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">Message recieved from </span><span class="dl">'</span> <span class="o">+</span> <span class="nx">message</span><span class="p">.</span><span class="nx">author</span><span class="p">.</span><span class="nx">id</span> <span class="o">+</span> <span class="dl">'</span><span class="s1"> at </span><span class="dl">'</span> <span class="o">+</span> <span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">().</span><span class="nx">toString</span><span class="p">());</span>
            
                        <span class="c1">// Sets the userid for the recipiant</span>
                        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">mess</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="nx">replace</span><span class="p">(</span><span class="dl">'</span><span class="s1">&lt;@</span><span class="dl">'</span><span class="p">,</span> <span class="dl">''</span><span class="p">).</span><span class="nx">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span>
                        <span class="nx">userid</span> <span class="o">=</span> <span class="nx">client</span><span class="p">.</span><span class="nx">users</span><span class="p">.</span><span class="nx">cache</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="nx">user</span> <span class="o">=&gt;</span> <span class="nx">user</span><span class="p">.</span><span class="nx">id</span> <span class="o">===</span> <span class="p">(</span><span class="nx">mess</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="nx">replace</span><span class="p">(</span><span class="dl">'</span><span class="s1">&lt;@</span><span class="dl">'</span><span class="p">,</span> <span class="dl">''</span><span class="p">).</span><span class="nx">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)))</span>
                        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">userid</span><span class="p">)</span>
                        
                        <span class="c1">// Sets the return time</span>
                        <span class="nx">timemeasure</span> <span class="o">=</span> <span class="nx">mess</span><span class="p">[</span><span class="mi">2</span><span class="p">].</span><span class="nx">substring</span><span class="p">((</span><span class="nx">mess</span><span class="p">[</span><span class="mi">2</span><span class="p">].</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="nx">mess</span><span class="p">[</span><span class="mi">2</span><span class="p">].</span><span class="nx">length</span><span class="p">))</span>
                        <span class="nx">returntime</span> <span class="o">=</span> <span class="nx">mess</span><span class="p">[</span><span class="mi">2</span><span class="p">].</span><span class="nx">substring</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="nx">mess</span><span class="p">[</span><span class="mi">2</span><span class="p">].</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>
            
                        <span class="c1">// Based off the delimiter, sets the time</span>
                        <span class="k">switch</span> <span class="p">(</span><span class="nx">timemeasure</span><span class="p">)</span> <span class="p">{</span>
                            <span class="k">case</span> <span class="dl">'</span><span class="s1">s</span><span class="dl">'</span><span class="p">:</span>
                                <span class="nx">returntime</span> <span class="o">=</span> <span class="nx">returntime</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">;</span>
                                <span class="k">break</span><span class="p">;</span>
            
                            <span class="k">case</span> <span class="dl">'</span><span class="s1">m</span><span class="dl">'</span><span class="p">:</span>
                                <span class="nx">returntime</span> <span class="o">=</span> <span class="nx">returntime</span> <span class="o">*</span> <span class="mi">1000</span> <span class="o">*</span> <span class="mi">60</span><span class="p">;</span>
                                <span class="k">break</span><span class="p">;</span>
            
                            <span class="k">case</span> <span class="dl">'</span><span class="s1">h</span><span class="dl">'</span><span class="p">:</span>
                                <span class="nx">returntime</span> <span class="o">=</span> <span class="nx">returntime</span> <span class="o">*</span> <span class="mi">1000</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">60</span><span class="p">;</span>
                                <span class="k">break</span><span class="p">;</span>
            
                            <span class="k">case</span> <span class="dl">'</span><span class="s1">d</span><span class="dl">'</span><span class="p">:</span>
                                <span class="nx">returntime</span> <span class="o">=</span> <span class="nx">returntime</span> <span class="o">*</span> <span class="mi">1000</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">24</span><span class="p">;</span>
                                <span class="k">break</span><span class="p">;</span>
            
                            <span class="nl">default</span><span class="p">:</span>
                                <span class="nx">returntime</span> <span class="o">=</span> <span class="nx">returntime</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">;</span>
                                <span class="k">break</span><span class="p">;</span>
                        <span class="p">}</span>
            
                        <span class="c1">// Returns the Message</span>
                        <span class="nx">setTimeout</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
                            <span class="c1">// Removes the first 2 array items</span>
                            <span class="nx">mess</span><span class="p">.</span><span class="nx">shift</span><span class="p">();</span>
                            <span class="nx">mess</span><span class="p">.</span><span class="nx">shift</span><span class="p">();</span>
                            <span class="nx">mess</span><span class="p">.</span><span class="nx">shift</span><span class="p">();</span>
            
                            <span class="c1">// Creates the message</span>
                            <span class="kd">var</span> <span class="nx">content</span> <span class="o">=</span> <span class="nx">mess</span><span class="p">.</span><span class="nx">join</span><span class="p">();</span>
                            <span class="nx">content</span> <span class="o">=</span> <span class="nx">content</span><span class="p">.</span><span class="nx">replaceAll</span><span class="p">(</span><span class="dl">'</span><span class="s1">,</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1"> </span><span class="dl">'</span><span class="p">);</span>
                            <span class="nx">message</span><span class="p">.</span><span class="nx">reply</span><span class="p">(</span><span class="dl">"</span><span class="s2">&lt;@</span><span class="dl">"</span> <span class="o">+</span> <span class="nx">userid</span> <span class="o">+</span><span class="dl">"</span><span class="s2">&gt; </span><span class="dl">"</span> <span class="o">+</span> <span class="nx">content</span><span class="p">);</span>
                            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">Message sent to </span><span class="dl">'</span> <span class="o">+</span> <span class="nx">userid</span> <span class="o">+</span> <span class="dl">'</span><span class="s1"> at </span><span class="dl">'</span> <span class="o">+</span> <span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">().</span><span class="nx">toString</span><span class="p">());</span>
                        <span class="p">},</span> <span class="nx">returntime</span><span class="p">)</span>
                    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
                        <span class="nx">message</span><span class="p">.</span><span class="nx">reply</span><span class="p">(</span><span class="dl">"</span><span class="s2">An error has occured, please make sure the command has a time delimiter and message</span><span class="dl">"</span><span class="p">);</span>
                        <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">toString</span><span class="p">());</span>
                    <span class="p">}</span>
</code></pre></div></div><p>It is able to set both reminders for self and for other users and can take input in seconds, minutes, hours and days. Whether the bot is up enough for the days to take effect is a different problem altogether.</p><p><img src="/assets/images/reminder.png" alt="" /></p><p><img src="/assets/images/likethis.png" alt="" /></p><h2 id="weekly-psa"> Weekly PSA <a href="#weekly-psa">#</a></h2><p>This one is a very short and simple function that sends 2 PSAs at the start of each week with some useful reminders for the game.</p><div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="kd">const</span> <span class="nx">job</span> <span class="o">=</span> <span class="nx">cron</span><span class="p">.</span><span class="nx">job</span><span class="p">(</span><span class="dl">'</span><span class="s1">01 00 14 * * 1</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">client</span><span class="p">.</span><span class="nx">channels</span><span class="p">.</span><span class="nx">cache</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="dl">'</span><span class="s1">653719279111372810</span><span class="dl">'</span><span class="p">).</span><span class="nx">send</span><span class="p">(</span><span class="dl">"</span><span class="s2">Commanders, don't forget to renew your exploration squad!</span><span class="dl">"</span><span class="p">);</span>
        <span class="nx">job</span><span class="p">.</span><span class="nx">stop</span><span class="p">();</span>
    <span class="p">});</span>

    <span class="nx">job</span><span class="p">.</span><span class="nx">start</span><span class="p">();</span>

    <span class="kd">const</span> <span class="nx">job4</span> <span class="o">=</span> <span class="nx">cron</span><span class="p">.</span><span class="nx">job</span><span class="p">(</span><span class="dl">'</span><span class="s1">01 00 10 * * 1</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">client</span><span class="p">.</span><span class="nx">channels</span><span class="p">.</span><span class="nx">cache</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="dl">'</span><span class="s1">653719279111372810</span><span class="dl">'</span><span class="p">).</span><span class="nx">send</span><span class="p">(</span><span class="dl">"</span><span class="s2">Commanders, it's a new week! Don't forget to share and let's do our best!</span><span class="dl">"</span><span class="p">);</span>
        <span class="nx">job4</span><span class="p">.</span><span class="nx">stop</span><span class="p">();</span>
    <span class="p">});</span>

    <span class="nx">job4</span><span class="p">.</span><span class="nx">start</span><span class="p">();</span>

</code></pre></div></div><p><img src="/assets/images/PSA.png" alt="" /></p><h2 id="reboot-option"> Reboot option <a href="#reboot-option">#</a></h2><p>Because this bot is written in JavaScript, it often hangs and crashes for no reason but not hard enough to show the bot as offline. To combat that, I added a function to reboot the bot from discord.</p><div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">mess</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="dl">'</span><span class="s1">!whack</span><span class="dl">'</span><span class="p">))</span> <span class="p">{</span>
                    <span class="kd">var</span> <span class="nx">painResponses</span> <span class="o">=</span> <span class="p">[</span><span class="dl">'</span><span class="s1">Oww my head ಥ﹏ಥ</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">Why are you doing this to me ( ˃̣̣̥⌓˂̣̣̥ )</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">Not again (つ﹏&lt;)</span><span class="dl">'</span><span class="p">,</span> <span class="p">(</span><span class="dl">"</span><span class="s2"> </span><span class="dl">"</span><span class="p">,</span> <span class="p">{</span><span class="na">files</span><span class="p">:</span> <span class="p">[</span><span class="dl">"</span><span class="s2">./Assets/Images/feels9.png</span><span class="dl">"</span><span class="p">]})];</span>
                    <span class="kd">const</span> <span class="nx">painReply</span> <span class="o">=</span> <span class="nx">painResponses</span><span class="p">[</span><span class="nx">getRandomInt</span><span class="p">(</span><span class="nx">painResponses</span><span class="p">.</span><span class="nx">length</span><span class="p">)];</span>
                    <span class="nx">message</span><span class="p">.</span><span class="nx">channel</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">painReply</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="k">async</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">message</span><span class="p">)</span> <span class="p">{</span>
                        <span class="k">await</span> <span class="nx">restartProcess</span><span class="p">();</span>
                    <span class="p">});</span>
</code></pre></div></div><h2 id="delete-messages"> Delete messages <a href="#delete-messages">#</a></h2><p>Another simple function, mostly for server management and deleting large amounts of text.</p><div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">mess</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="dl">'</span><span class="s1">!purge</span><span class="dl">'</span><span class="p">))</span> <span class="p">{</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nx">message</span><span class="p">.</span><span class="nx">member</span><span class="p">.</span><span class="nx">permissions</span><span class="p">.</span><span class="nx">has</span><span class="p">(</span><span class="dl">'</span><span class="s1">MANAGE_MESSAGES</span><span class="dl">'</span><span class="p">))</span> <span class="p">{</span>
                        <span class="kd">var</span> <span class="nx">messNum</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
                        <span class="k">if</span> <span class="p">(</span><span class="nx">mess</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">6</span><span class="p">)</span> <span class="p">{</span>
                            <span class="nx">messNum</span> <span class="o">=</span> <span class="nx">mess</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="dl">'</span><span class="s1"> </span><span class="dl">'</span><span class="p">)[</span><span class="mi">1</span><span class="p">];</span>
                        <span class="p">}</span>
                        <span class="k">async</span> <span class="kd">function</span> <span class="nx">purge</span><span class="p">()</span> <span class="p">{</span>
                            <span class="kd">var</span> <span class="nx">fetched</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">message</span><span class="p">.</span><span class="nx">channel</span><span class="p">.</span><span class="nx">messages</span><span class="p">.</span><span class="nx">fetch</span><span class="p">({</span><span class="na">limit</span><span class="p">:</span> <span class="p">(</span><span class="nx">messNum</span> <span class="o">&lt;</span> <span class="mi">50</span> <span class="p">?</span> <span class="p">(</span><span class="nb">Number</span><span class="p">(</span><span class="nx">messNum</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="p">:</span> <span class="mi">50</span><span class="p">)});</span>
                            <span class="nx">message</span><span class="p">.</span><span class="nx">channel</span><span class="p">.</span><span class="nx">bulkDelete</span><span class="p">(</span><span class="nx">fetched</span><span class="p">);</span>
                            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">Deleting the last </span><span class="dl">"</span> <span class="o">+</span> <span class="nx">fetched</span><span class="p">.</span><span class="nx">size</span> <span class="o">+</span> <span class="dl">"</span><span class="s2"> message(s).</span><span class="dl">"</span><span class="p">);</span>
                        <span class="p">}</span>
                        <span class="nx">purge</span><span class="p">();</span>
</code></pre></div></div><p>It takes an int input with the number of messages to delete and checks that there aren’t more than 50 messages in the request (fat finger protection).</p><h2 id="random-discord-interactions"> Random Discord interactions <a href="#random-discord-interactions">#</a></h2><p><img src="/assets/images/smug9.png" alt="" /></p><p>This was another feature that got toned down over time. The bot will randomly send :3 messages in Discord and has a 0.01% chance to pat someone after they posted something. Upon a user sending a message, a dice is rolled to determine if the bot should send a :3 message. Then another dice is rolled to determine with how much delay should the bot send the message. This makes it appear somewhat more natural and can lead to some funny timing.</p><div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">rando</span> <span class="o">=</span> <span class="nx">getRandomInt</span><span class="p">(</span><span class="mi">90000</span><span class="p">)</span> <span class="o">+</span> <span class="mi">5000</span><span class="p">;</span>
            <span class="kd">var</span> <span class="nx">chance</span> <span class="o">=</span> <span class="nx">getRandomInt</span><span class="p">(</span><span class="mi">1000</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
            <span class="kd">var</span> <span class="nx">chance2</span> <span class="o">=</span> <span class="nx">getRandomInt</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="kd">var</span> <span class="nx">randomHour</span> <span class="o">=</span> <span class="nx">getRandomInt</span><span class="p">(</span><span class="mi">23</span><span class="p">);</span>
            <span class="kd">var</span> <span class="nx">randomMinute</span> <span class="o">=</span> <span class="nx">getRandomInt</span><span class="p">(</span><span class="mi">59</span><span class="p">);</span>

            
            <span class="nx">client</span><span class="p">.</span><span class="nx">user</span><span class="p">.</span><span class="nx">setPresence</span><span class="p">({</span>
                <span class="na">status</span><span class="p">:</span> <span class="dl">'</span><span class="s1">online</span><span class="dl">'</span><span class="p">,</span>
                <span class="na">activity</span><span class="p">:</span> <span class="p">{</span>
                    <span class="na">name</span><span class="p">:</span> <span class="dl">'</span><span class="s1">you</span><span class="dl">'</span><span class="p">,</span>
                    <span class="na">type</span><span class="p">:</span> <span class="dl">'</span><span class="s1">WATCHING</span><span class="dl">'</span>
                <span class="p">}</span>
            <span class="p">});</span>

            <span class="k">if</span> <span class="p">(</span><span class="nx">chance</span> <span class="o">==</span> <span class="mi">1</span><span class="p">){</span>
                <span class="nx">setTimeout</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
                    <span class="nx">message</span><span class="p">.</span><span class="nx">channel</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="dl">'</span><span class="s1">*pats* </span><span class="dl">'</span> <span class="o">+</span> <span class="nx">message</span><span class="p">.</span><span class="nx">author</span><span class="p">.</span><span class="nx">toString</span><span class="p">()</span> <span class="o">+</span> <span class="dl">"</span><span class="s2"> :3</span><span class="dl">"</span><span class="p">);</span>
                <span class="p">},</span> <span class="nx">rando</span><span class="p">);</span>
            <span class="p">}</span>

            <span class="k">if</span> <span class="p">(</span><span class="nx">chance2</span> <span class="o">==</span> <span class="mi">1</span><span class="p">){</span>
                <span class="kd">const</span> <span class="nx">job3</span> <span class="o">=</span> <span class="nx">cron</span><span class="p">.</span><span class="nx">job</span><span class="p">(</span><span class="dl">'</span><span class="s1">00 </span><span class="dl">'</span> <span class="o">+</span> <span class="nx">randomMinute</span> <span class="o">+</span> <span class="dl">'</span><span class="s1"> </span><span class="dl">'</span> <span class="o">+</span> <span class="nx">randomHour</span> <span class="o">+</span> <span class="dl">'</span><span class="s1"> * * *</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
                    <span class="nx">message</span><span class="p">.</span><span class="nx">channel</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="dl">"</span><span class="s2">:3</span><span class="dl">"</span><span class="p">);</span>
                    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">randomMinute</span><span class="p">)</span>
                    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">randomHour</span><span class="p">)</span>
                    <span class="kd">var</span> <span class="nx">randomHour</span> <span class="o">=</span> <span class="nx">getRandomInt</span><span class="p">(</span><span class="mi">23</span><span class="p">);</span>
                    <span class="kd">var</span> <span class="nx">randomMinute</span> <span class="o">=</span> <span class="nx">getRandomInt</span><span class="p">(</span><span class="mi">59</span><span class="p">);</span>
                    <span class="nx">job3</span><span class="p">.</span><span class="nx">stop</span><span class="p">()</span>
                    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">randomMinute</span><span class="p">)</span>
                    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">randomHour</span><span class="p">)</span>
                <span class="p">});</span>
                <span class="nx">job3</span><span class="p">.</span><span class="nx">start</span><span class="p">()</span>
            <span class="p">}</span>
</code></pre></div></div><p>This feature has actually been a great exercise in observing how randomness can create emergent humour and how people will attribute higher intelligence to a glorified dice roller.</p><h2 id="image-tagging"> Image tagging <a href="#image-tagging">#</a></h2><p>A big feature, part of my experiments and getting more hands on with AI. Unfortunately, it has also been removed since I moved the bot to a rasPi that does not have the processing power to use this function.</p><p><img src="/assets/images/tag.png" alt="" /></p><p>The underlying detection engine is powered by DeepDanbooru: <a href="https://github.com/KichangKim/DeepDanbooru">https://github.com/KichangKim/DeepDanbooru</a></p><p>While I did try to run my own training on it, some quick back of the envelope maths showed that I would need about 800 GBs of storage to store all the pictures from Danbooru, so I went with some of the pretrained options. I designed the function to take an image as an input, save it locally and timestamp it, and then run the DeepDanbooru tag recognition engine on it. This helped not cross the streams when users from different servers would submit images at the same time.</p><div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>                <span class="c1">// DeepDanbooru</span>
                <span class="c1">//https://blog.sukasuka.cn/?p=759</span>
                <span class="p">}</span> <span class="k">else</span> <span class="k">if</span>  <span class="p">(</span><span class="nx">mess</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="dl">'</span><span class="s1">!tag</span><span class="dl">'</span><span class="p">)){</span>
                    <span class="kd">const</span> <span class="nx">fs</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">`fs`</span><span class="p">);</span>
                    <span class="kd">const</span> <span class="k">async</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">async</span><span class="dl">'</span><span class="p">);</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nx">message</span><span class="p">.</span><span class="nx">attachments</span><span class="p">.</span><span class="nx">size</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
                        <span class="k">async</span> <span class="kd">function</span> <span class="nx">start</span><span class="p">()</span> <span class="p">{</span>
             
                        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">This is an image</span><span class="dl">"</span><span class="p">)</span>
                        <span class="c1">//Save image</span>
                        <span class="kd">const</span> <span class="nx">imageIdentifer</span> <span class="o">=</span> <span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">()</span>

                        <span class="k">await</span> <span class="k">new</span> <span class="nb">Promise</span><span class="p">(</span><span class="nx">resolve</span> <span class="o">=&gt;</span>
                            <span class="nx">request</span><span class="p">(</span><span class="nx">message</span><span class="p">.</span><span class="nx">attachments</span><span class="p">.</span><span class="nx">first</span><span class="p">().</span><span class="nx">url</span><span class="p">)</span>
                              <span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">fs</span><span class="p">.</span><span class="nx">createWriteStream</span><span class="p">(</span><span class="s2">`deepImages/Img-</span><span class="p">${</span><span class="nx">imageIdentifer</span><span class="p">}</span><span class="s2">.png`</span><span class="p">))</span>
                              <span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="dl">'</span><span class="s1">finish</span><span class="dl">'</span><span class="p">,</span> <span class="nx">resolve</span><span class="p">));</span>

                        <span class="kd">var</span> <span class="nx">output</span> <span class="o">=</span> <span class="nx">shell</span><span class="p">.</span><span class="nx">exec</span><span class="p">(</span><span class="s2">`deepdanbooru.exe evaluate --model-path deepdanbooru/model/model-resnet_custom_v4.h5 --tags-path deepdanbooru/model/tags.txt deepImages/Img-</span><span class="p">${</span><span class="nx">imageIdentifer</span><span class="p">}</span><span class="s2">.png`</span><span class="p">).</span><span class="nx">stdout</span><span class="p">;</span>

                        <span class="nx">danbooruResponse</span> <span class="o">=</span> <span class="nx">output</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="dl">'</span><span class="s1">png:</span><span class="dl">'</span><span class="p">)[</span><span class="mi">1</span><span class="p">];</span>
                        


                        <span class="nx">message</span><span class="p">.</span><span class="nx">channel</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">danbooruResponse</span><span class="p">)</span>
                        <span class="p">}</span>
                        <span class="nx">start</span><span class="p">()</span>


                    <span class="p">}</span>
                <span class="o">*</span><span class="sr">/</span><span class="err">
</span></code></pre></div></div><p>It worked very well even on non anime images</p><p><img src="/assets/images/tag2.png" alt="" /></p><p>While this feature certainly had the “wow factor” on point, it had very little use and it forced me to run the bot on a beefier machine. In the end, I ended up commenting it out as I moved the bot to a rasPi.</p><h2 id="real-time-status-adjustments"> Real time status adjustments <a href="#real-time-status-adjustments">#</a></h2><p>A funny gimmick that I used to play around with the discord API. The bot will change its status from away and “Watching terrible anime” to present and “Watching you”, and will revert back after interaction stops.</p><div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="nx">client</span><span class="p">.</span><span class="nx">user</span><span class="p">.</span><span class="nx">setPresence</span><span class="p">({</span>
        <span class="na">status</span><span class="p">:</span> <span class="dl">'</span><span class="s1">idle</span><span class="dl">'</span><span class="p">,</span>
        <span class="na">activity</span><span class="p">:</span> <span class="p">{</span>
            <span class="na">name</span><span class="p">:</span> <span class="dl">'</span><span class="s1">terrible anime</span><span class="dl">'</span><span class="p">,</span>
            <span class="na">type</span><span class="p">:</span> <span class="dl">'</span><span class="s1">WATCHING</span><span class="dl">'</span>
        <span class="p">}</span>
    <span class="p">});</span>
</code></pre></div></div><div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">client</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="dl">'</span><span class="s1">message</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">message</span><span class="p">){</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">message</span><span class="p">.</span><span class="nx">member</span><span class="p">.</span><span class="nx">permissions</span><span class="p">.</span><span class="nx">has</span><span class="p">(</span><span class="dl">"</span><span class="s2">SEND_MESSAGES</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">READ_MESSAGE_HISTORY</span><span class="dl">"</span><span class="p">)){</span>

            <span class="nx">client</span><span class="p">.</span><span class="nx">user</span><span class="p">.</span><span class="nx">setPresence</span><span class="p">({</span>
                <span class="na">status</span><span class="p">:</span> <span class="dl">'</span><span class="s1">online</span><span class="dl">'</span><span class="p">,</span>
                <span class="na">activity</span><span class="p">:</span> <span class="p">{</span>
                    <span class="na">name</span><span class="p">:</span> <span class="dl">'</span><span class="s1">you</span><span class="dl">'</span><span class="p">,</span>
                    <span class="na">type</span><span class="p">:</span> <span class="dl">'</span><span class="s1">WATCHING</span><span class="dl">'</span>
                <span class="p">}</span>
            <span class="p">});</span>
</code></pre></div></div><h2 id="soundboard"> Soundboard <a href="#soundboard">#</a></h2><p>Simple feature that essentially uploads .mp3 files to the chat that can be played on desktop. Most of them are memes.</p><div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">mess</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="dl">'</span><span class="s1">!emergency</span><span class="dl">'</span><span class="p">))</span> <span class="p">{</span>
                    <span class="nx">message</span><span class="p">.</span><span class="nx">channel</span><span class="p">.</span><span class="nx">send</span><span class="p">({</span> <span class="na">files</span><span class="p">:</span> <span class="p">[{</span> <span class="na">attachment</span><span class="p">:</span> <span class="dl">'</span><span class="s1">./Assets/Audio/Energency.mp3</span><span class="dl">'</span> <span class="p">}]</span> <span class="p">});</span>
                <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">mess</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="dl">'</span><span class="s1">!presentday</span><span class="dl">'</span><span class="p">))</span> <span class="p">{</span>
                    <span class="nx">message</span><span class="p">.</span><span class="nx">channel</span><span class="p">.</span><span class="nx">send</span><span class="p">({</span> <span class="na">files</span><span class="p">:</span> <span class="p">[{</span> <span class="na">attachment</span><span class="p">:</span> <span class="dl">'</span><span class="s1">./Assets/Audio/Present_Day_heh..._Present_Time.mp3</span><span class="dl">'</span> <span class="p">}]</span> <span class="p">});</span>
                <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">mess</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="dl">'</span><span class="s1">!ugly</span><span class="dl">'</span><span class="p">))</span> <span class="p">{</span>
                    <span class="nx">message</span><span class="p">.</span><span class="nx">channel</span><span class="p">.</span><span class="nx">send</span><span class="p">({</span> <span class="na">files</span><span class="p">:</span> <span class="p">[{</span> <span class="na">attachment</span><span class="p">:</span> <span class="dl">'</span><span class="s1">./Assets/Audio/ugly.mp3</span><span class="dl">'</span> <span class="p">}]</span> <span class="p">});</span>
                <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">mess</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="dl">'</span><span class="s1">!whip</span><span class="dl">'</span><span class="p">))</span> <span class="p">{</span>
                    <span class="nx">message</span><span class="p">.</span><span class="nx">channel</span><span class="p">.</span><span class="nx">send</span><span class="p">({</span> <span class="na">files</span><span class="p">:</span> <span class="p">[{</span> <span class="na">attachment</span><span class="p">:</span> <span class="dl">'</span><span class="s1">./Assets/Audio/whip.mp3</span><span class="dl">'</span> <span class="p">}]</span> <span class="p">});</span>
                <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">mess</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="dl">'</span><span class="s1">!gameover</span><span class="dl">'</span><span class="p">))</span> <span class="p">{</span>
                    <span class="nx">message</span><span class="p">.</span><span class="nx">channel</span><span class="p">.</span><span class="nx">send</span><span class="p">({</span> <span class="na">files</span><span class="p">:</span> <span class="p">[{</span> <span class="na">attachment</span><span class="p">:</span> <span class="dl">'</span><span class="s1">./Assets/Audio/SOPMOD_Game_Over.mp3</span><span class="dl">'</span> <span class="p">}]</span> <span class="p">});</span>
                <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">mess</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="dl">'</span><span class="s1">!bossbattle</span><span class="dl">'</span><span class="p">))</span> <span class="p">{</span>
                    <span class="nx">message</span><span class="p">.</span><span class="nx">channel</span><span class="p">.</span><span class="nx">send</span><span class="p">({</span> <span class="na">files</span><span class="p">:</span> <span class="p">[{</span> <span class="na">attachment</span><span class="p">:</span> <span class="dl">'</span><span class="s1">./Assets/Audio/whiteNyto.mp3</span><span class="dl">'</span> <span class="p">}]</span> <span class="p">});</span>
                <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">mess</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="dl">'</span><span class="s1">!triggered</span><span class="dl">'</span><span class="p">))</span> <span class="p">{</span>
                    <span class="nx">message</span><span class="p">.</span><span class="nx">channel</span><span class="p">.</span><span class="nx">send</span><span class="p">({</span> <span class="na">files</span><span class="p">:</span> <span class="p">[{</span> <span class="na">attachment</span><span class="p">:</span> <span class="dl">'</span><span class="s1">./Assets/Audio/One_more_group_offended.mp3</span><span class="dl">'</span> <span class="p">}]</span> <span class="p">});</span>
                <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">mess</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="dl">'</span><span class="s1">!vice</span><span class="dl">'</span><span class="p">))</span> <span class="p">{</span>
                    <span class="nx">message</span><span class="p">.</span><span class="nx">channel</span><span class="p">.</span><span class="nx">send</span><span class="p">({</span> <span class="na">files</span><span class="p">:</span> <span class="p">[{</span> <span class="na">attachment</span><span class="p">:</span> <span class="dl">'</span><span class="s1">./Assets/Audio/Vice_news_disclaimer.mp3</span><span class="dl">'</span> <span class="p">}]</span> <span class="p">});</span>
                <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">mess</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="dl">'</span><span class="s1">!soplaugh</span><span class="dl">'</span><span class="p">))</span> <span class="p">{</span>
                    <span class="nx">message</span><span class="p">.</span><span class="nx">channel</span><span class="p">.</span><span class="nx">send</span><span class="p">({</span> <span class="na">files</span><span class="p">:</span> <span class="p">[{</span> <span class="na">attachment</span><span class="p">:</span> <span class="dl">'</span><span class="s1">./Assets/Audio/soplaugh.mp3</span><span class="dl">'</span> <span class="p">}]</span> <span class="p">});</span>
                <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">mess</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="dl">'</span><span class="s1">!DA NYA</span><span class="dl">'</span><span class="p">))</span> <span class="p">{</span>
                    <span class="nx">message</span><span class="p">.</span><span class="nx">channel</span><span class="p">.</span><span class="nx">send</span><span class="p">({</span> <span class="na">files</span><span class="p">:</span> <span class="p">[{</span> <span class="na">attachment</span><span class="p">:</span> <span class="dl">'</span><span class="s1">./Assets/Audio/Nyaaaaa_IDW.mp3</span><span class="dl">'</span> <span class="p">}]</span> <span class="p">});</span>
                <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">mess</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="dl">'</span><span class="s1">!motivational</span><span class="dl">'</span><span class="p">))</span> <span class="p">{</span>
                    <span class="nx">message</span><span class="p">.</span><span class="nx">channel</span><span class="p">.</span><span class="nx">send</span><span class="p">({</span> <span class="na">files</span><span class="p">:</span> <span class="p">[{</span> <span class="na">attachment</span><span class="p">:</span> <span class="dl">'</span><span class="s1">./Assets/Audio/Nothing_is_possible.mp3</span><span class="dl">'</span> <span class="p">}]</span> <span class="p">});</span>
</code></pre></div></div><p>A year or so ago we had a few attempts at a podcast and added a function to have the bot join the voice channel and play audio, feature which I assume is used by all those music bots. I haven’t updated it to the current discord API but here it is anyway:</p><div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>            <span class="cm">/* Disabled until fixed. TODO fix
                } else if (mess.includes('!play')) {
                    var voiceChannel = message.member.voice.channel;
                    voiceChannel.join().then(connection =&gt; {
                        const dispatcher = connection.play("./Assets/Audio/Vice_news_disclaimer.mp3");
                    }).catch(err =&gt; console.log(err));
                */</span>
</code></pre></div></div><h2 id="linux-fortune"> Linux fortune <a href="#linux-fortune">#</a></h2><p>The classic Linux terminal fortune command. Nothing more, nothing less. I have simply used a list with all the fortune outputs and a dice roller to pick a random one.</p><div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">mess</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="dl">'</span><span class="s1">!fortune</span><span class="dl">'</span><span class="p">))</span> <span class="p">{</span>
                    <span class="kd">var</span> <span class="nx">fs</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">fs</span><span class="dl">"</span><span class="p">);</span>
                    <span class="kd">var</span> <span class="nx">text</span> <span class="o">=</span> <span class="nx">fs</span><span class="p">.</span><span class="nx">readFileSync</span><span class="p">(</span><span class="dl">"</span><span class="s2">./Assets/Text/fortune.txt</span><span class="dl">"</span><span class="p">)</span> <span class="o">+</span> <span class="dl">''</span><span class="p">;</span>
                    <span class="kd">var</span> <span class="nx">textByLine</span> <span class="o">=</span> <span class="nx">text</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="dl">"</span><span class="se">\n</span><span class="dl">"</span><span class="p">);</span>
                    <span class="kd">var</span> <span class="nx">result</span> <span class="o">=</span> <span class="nx">textByLine</span><span class="p">[</span><span class="nx">getRandomInt</span><span class="p">(</span><span class="nx">textByLine</span><span class="p">.</span><span class="nx">length</span><span class="p">)];</span>
                    <span class="nx">message</span><span class="p">.</span><span class="nx">channel</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">result</span><span class="p">);</span>
</code></pre></div></div><h2 id="other-misc-features"> Other misc features <a href="#other-misc-features">#</a></h2><p>A lot of these have been removed by the few left in:</p><p>The bot with react to being patted or being asked for patting:</p><div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">mess</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="dl">'</span><span class="s1">!p[a,e]t me</span><span class="dl">'</span><span class="p">))</span> <span class="p">{</span>
                    <span class="nx">message</span><span class="p">.</span><span class="nx">channel</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="dl">'</span><span class="s1">*pat pat* </span><span class="dl">'</span> <span class="o">+</span> <span class="nx">message</span><span class="p">.</span><span class="nx">author</span><span class="p">.</span><span class="nx">username</span><span class="p">);</span>
                <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">mess</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="dl">'</span><span class="s1">!(p[a,e]t)+[s]?</span><span class="dl">'</span><span class="p">))</span> <span class="p">{</span>
                    <span class="kd">var</span> <span class="nx">patResponses</span> <span class="o">=</span> <span class="p">[</span><span class="dl">"</span><span class="s2">Thank you! I'm trying my best! ♫</span><span class="dl">"</span><span class="p">,</span> <span class="dl">'</span><span class="s1">:3 ♫</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">❤️</span><span class="dl">'</span><span class="p">];</span>
                    <span class="kd">const</span> <span class="nx">patReply</span> <span class="o">=</span> <span class="nx">patResponses</span><span class="p">[</span><span class="nx">getRandomInt</span><span class="p">(</span><span class="nx">patResponses</span><span class="p">.</span><span class="nx">length</span><span class="p">)];</span>
                    <span class="nx">message</span><span class="p">.</span><span class="nx">channel</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">patReply</span><span class="p">);</span>
</code></pre></div></div><p>The Discord token is not stored in the program file but as a system variable:</p><div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">discord_token</span> <span class="o">=</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">DISCORD_TOKEN</span><span class="p">;</span>
<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">discord_token</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">DISCORD_TOKEN is empty. Please run </span><span class="se">\"</span><span class="s2">export DISCORD_TOKEN=&lt;your token here&gt;</span><span class="se">\"</span><span class="s2">, then try again.</span><span class="dl">"</span><span class="p">);</span>
    <span class="nx">process</span><span class="p">.</span><span class="nx">exit</span><span class="p">();</span>
<span class="p">}</span>

<span class="nx">client</span><span class="p">.</span><span class="nx">login</span><span class="p">(</span><span class="nx">discord_token</span><span class="p">);</span>
</code></pre></div></div><p>I have also added a very dirty and hacky error handler to deal with the idiosyncrasies of JavaScript.</p><div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">process</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="dl">'</span><span class="s1">uncaughtException</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">Crashn't</span><span class="dl">"</span><span class="p">);</span>
  <span class="p">});</span>

</code></pre></div></div><p>!flood will spam a lot of :3 to clear up the screen. Useful when you’re at work and someone posted something NSFW.</p><p><img src="/assets/images/flood.png" alt="" /></p><div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">mess</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="dl">'</span><span class="s1">!flood</span><span class="dl">'</span><span class="p">))</span> <span class="p">{</span>
                    <span class="nx">message</span><span class="p">.</span><span class="nx">channel</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="dl">"</span><span class="s2">:3</span><span class="se">\n</span><span class="s2">:3</span><span class="se">\n</span><span class="s2">:3</span><span class="se">\n</span><span class="s2">:3</span><span class="se">\n</span><span class="s2">:3</span><span class="se">\n</span><span class="s2">:3</span><span class="se">\n</span><span class="s2">...)
}
</span></code></pre></div></div><h2 id="conclussion"> Conclussion <a href="#conclussion">#</a></h2><p>I am still not sure if this is a serious project or still a joke. The code quality is certainly not up to par and the development schedule follows a very strict “when I feel like it” schedule. The bot is currently in use on about a dozen servers and I haven’t received any complaints for its current implementation. I have learned a lot from playing around with it and it gave me an excuse to avoid tinkering as I was working towards a real project, as loosely defined as that might be.</p><p>I think I am ready to shelve this project, which is why I am writing this blog post in the first place. It has become bloated enough and I have other things that demand more of my attention right now. The full code, sans the Replika part, is available here:</p><p><a href="https://github.com/robsware/UMP9-public/blob/main/index.js">https://github.com/robsware/UMP9-public/blob/main/index.js</a></p><p>I have another bot that I have been brainstorming ideas about, mostly focused on assisting the workflow in my infosec job and hobbies. I can see myself using the lessons I learned from working on UMP9 on that, although I will be avoiding pure JavaScript and will either stick with TypeScript or Python.</p><p>I find bots fascinating and I love the idea of having those tiny helpers around. While the offerings of big companies (google, alexa, siri) are much better than anything I could write by myself, I think a touch of auteur makes it more endearing. It is a real, human touch instead of a corporate, (mostly) polished product. The knowledge gained in this experiment already came in useful plenty of times, so in the end, I’m glad I did it.</p></section><section><nav class="post-nav"> <a class="post-nav-item post-nav-prev" href="/2022/06/22/osep"><div class="nav-arrow">Previous</div><span class="post-title">OSEP - Finding my limits</span> </a> <a class="post-nav-item post-nav-next" href="/2023/03/13/oswe"><div class="nav-arrow">Next</div><span class="post-title">OSWE Review - A return to roots</span> </a></nav></section></main><script> function setTheme(theme) { if (theme === "dark") { document.documentElement.setAttribute('data-theme', 'dark'); window.localStorage.setItem('theme', 'dark'); document.getElementById("theme-toggle").classList.add('sun'); document.getElementById("theme-toggle").classList.remove('moon'); } else { document.documentElement.setAttribute('data-theme', 'light'); window.localStorage.setItem('theme', 'light'); document.getElementById("theme-toggle").classList.add('moon'); document.getElementById("theme-toggle").classList.remove('sun'); } } let theme = localStorage.getItem('theme'); theme = theme || (window.matchMedia ? window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light' : 'light'); setTheme(theme); function modeSwitcher() { let currentMode = document.documentElement.getAttribute('data-theme'); if (currentMode === "dark") { setTheme('light'); } else { setTheme('dark'); } } </script></body><footer class="social-footer"><div class="social-footer-icons"> <a href="https://github.com/robsware" title="Github profile" target="_blank" rel="noopener noreferrer"><i class="fa fa-github" aria-hidden="true"></i></a> <a href="https://robsware.github.io/atom.xml" title="Feed RSS" target="_blank" rel="noopener noreferrer"><i class="fa fa-rss" aria-hidden="true"></i></a> <a href="https://github.com/robsware/robsware.github.io" title="Browse the code" target="_blank" rel="noopener noreferrer"><i class="fa fa-code" aria-hidden="true"></i></a></div></footer></html>
